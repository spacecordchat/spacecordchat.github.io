{"version":3,"file":"cSsutH7pvNJ4jQlUOOLA.js","sources":["../../src/components/modals/SettingsPages/AccountSettingsPage.tsx"],"sourcesContent":["import { RESTPatchAPICurrentUserJSONBody, Routes } from \"@spacebarchat/spacebar-api-types/v9\";\nimport { observer } from \"mobx-react-lite\";\nimport { useEffect, useRef, useState } from \"react\";\nimport styled, { css } from \"styled-components\";\nimport { useAppStore } from \"../../../hooks/useAppStore\";\nimport Avatar from \"../../Avatar\";\nimport Button from \"../../Button\";\nimport SectionTitle from \"../../SectionTitle\";\n\nconst Content = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\n\tmin-width: 30vw;\n`;\n\nconst UserInfoContainer = styled.div`\n\tborder-radius: 8px;\n\tbackground-color: var(--background-secondary);\n\tpadding: 16px;\n`;\n\nconst Field = styled.div<{ spacerTop?: boolean; spacerBottom?: boolean }>`\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: space-between;\n\n\t${(props) =>\n\t\tprops.spacerTop &&\n\t\tcss`\n\t\t\tmargin-top: 24px;\n\t\t`}\n\n\t${(props) =>\n\t\tprops.spacerBottom &&\n\t\tcss`\n\t\t\tmargin-bottom: 24px;\n\t\t`}\n`;\n\nconst Row = styled.div`\n\tdisplay: flex;\n\tflex: 1;\n\tflex-direction: column;\n\toverflow: hidden;\n\tmargin-right: 16px;\n`;\n\nconst FieldTitle = styled.span`\n\tmargin-bottom: 4px;\n\tcolor: var(--text-secondary);\n\tfont-size: 12px;\n\tfont-weight: var(--font-weight-medium);\n\tletter-spacing: 0.5px;\n`;\n\nconst FieldValue = styled.div`\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n`;\n\nconst FieldValueText = styled.span`\n\tcolor: var(--text);\n\tfont-size: 16px;\n\tfont-weight: var(--font-weight-regular);\n`;\n\nconst FieldValueToggle = styled.button`\n\tcolor: var(--text-link);\n\tcursor: pointer;\n\twidth: auto;\n\tdisplay: inline;\n\theight: auto;\n\tpadding: 2px 4px;\n\tposition: relative;\n\tbackground: none;\n\tborder: none;\n\tborder-radius: 4px;\n\tfont-size: 14px;\n\tfont-weight: var(--font-weight-medium);\n\tuser-select: none;\n\ttext-rendering: optimizeLegibility;\n`;\n\nconst IconContainer = styled.div`\n\tposition: relative;\n\tdisplay: inline-block;\n`;\n\nconst IconInput = styled.input`\n\tdisplay: none;\n`;\n\nconst FileInput = styled.div`\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\topacity: 0;\n\tcursor: pointer;\n\tfont-size: 0px;\n`;\n\nconst UnsavedChangesBar = styled.div`\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: space-between;\n\tbackground-color: var(--background-tertiary);\n\tpadding: 10px 16px;\n\tborder-radius: 8px;\n\tmargin-top: 24px;\n\talign-items: center;\n`;\n\nconst UnsavedChangedActions = styled.div`\n\tdisplay: flex;\n\tgap: 10px;\n`;\n\nconst Text = styled.p`\n\tcolor: var(--text-secondary);\n\tfont-size: 16px;\n\tfont-weight: var(--font-weight-medium);\n\tmargin: 0;\n\tpadding: 0;\n`;\n\nfunction AccountSettingsPage() {\n\tconst app = useAppStore();\n\tconst [shouldRedactEmail, setShouldRedactEmail] = useState(true);\n\tconst [selectedFile, setSelectedFile] = useState<File>();\n\tconst fileInputRef = useRef<HTMLInputElement>(null);\n\tconst [hasUnsavedChangd, setHasUnsavedChanged] = useState(false);\n\tconst [loading, setLoading] = useState(false);\n\n\tconst redactEmail = (email: string) => {\n\t\tconst [username, domain] = email.split(\"@\");\n\t\treturn `${\"*\".repeat(username.length)}@${domain}`;\n\t};\n\n\tconst redactPhoneNumber = (phoneNumber: string) => {\n\t\tconst lastFour = phoneNumber.slice(-4);\n\t\treturn \"*\".repeat(phoneNumber.length - 4) + lastFour;\n\t};\n\n\tconst onAvatarChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tif (!event.target.files) return;\n\t\tsetSelectedFile(event.target.files[0]);\n\t};\n\n\tconst discardChanges = () => {\n\t\tsetSelectedFile(undefined);\n\t};\n\n\tconst save = async () => {\n\t\tsetLoading(true);\n\t\tif (!selectedFile) return;\n\t\tconst reader = new FileReader();\n\t\treader.onload = async () => {\n\t\t\tconst payload: RESTPatchAPICurrentUserJSONBody = {\n\t\t\t\t// @ts-expect-error broken types or whatever\n\t\t\t\tavatar: reader.result,\n\t\t\t};\n\t\t\tapp.rest\n\t\t\t\t.patch<RESTPatchAPICurrentUserJSONBody, RESTPatchAPICurrentUserJSONBody>(Routes.user(), payload)\n\t\t\t\t.then((r) => {\n\t\t\t\t\t// runInAction(() => {\n\t\t\t\t\t// \tif (r.username) app.account!.username = r.username;\n\t\t\t\t\t// \tif (r.avatar) app.account!.avatar = r.avatar;\n\t\t\t\t\t// });\n\t\t\t\t\tsetSelectedFile(undefined);\n\t\t\t\t\tsetLoading(false);\n\t\t\t\t})\n\t\t\t\t.catch((e) => {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tsetLoading(false);\n\t\t\t\t});\n\t\t};\n\t\treader.readAsDataURL(selectedFile);\n\t};\n\n\tuseEffect(() => {\n\t\t// handle unsaved changes state\n\t\tif (selectedFile) {\n\t\t\tsetHasUnsavedChanged(true);\n\t\t} else {\n\t\t\t// Reset state if there is nothing changed\n\t\t\tsetHasUnsavedChanged(false);\n\t\t}\n\t}, [selectedFile]);\n\n\treturn (\n\t\t<div>\n\t\t\t<SectionTitle>Account</SectionTitle>\n\t\t\t<Content>\n\t\t\t\t<UserInfoContainer>\n\t\t\t\t\t<Field spacerBottom>\n\t\t\t\t\t\t<IconContainer>\n\t\t\t\t\t\t\t{selectedFile ? (\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tsrc={URL.createObjectURL(selectedFile)}\n\t\t\t\t\t\t\t\t\talt=\"Avatar\"\n\t\t\t\t\t\t\t\t\twidth=\"80px\"\n\t\t\t\t\t\t\t\t\theight=\"80px\"\n\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\tborderRadius: \"50%\",\n\t\t\t\t\t\t\t\t\t\tpointerEvents: \"none\",\n\t\t\t\t\t\t\t\t\t\tobjectFit: \"cover\",\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<Avatar user={app.account!} size={80} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<IconInput\n\t\t\t\t\t\t\t\tref={fileInputRef}\n\t\t\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\t\t\tname=\"avatar\"\n\t\t\t\t\t\t\t\taccept=\"image/*\"\n\t\t\t\t\t\t\t\tonChange={onAvatarChange}\n\t\t\t\t\t\t\t\tdisabled={loading}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<FileInput\n\t\t\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\n\t\t\t\t\t\t\t\taria-disabled={loading}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</IconContainer>\n\t\t\t\t\t</Field>\n\n\t\t\t\t\t<Field spacerBottom>\n\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t<FieldTitle>Username</FieldTitle>\n\n\t\t\t\t\t\t\t<FieldValue>\n\t\t\t\t\t\t\t\t<FieldValueText>\n\t\t\t\t\t\t\t\t\t{app.account?.username}#{app.account?.discriminator}\n\t\t\t\t\t\t\t\t</FieldValueText>\n\t\t\t\t\t\t\t</FieldValue>\n\t\t\t\t\t\t</Row>\n\t\t\t\t\t</Field>\n\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t<FieldTitle>Email</FieldTitle>\n\n\t\t\t\t\t\t\t<FieldValue>\n\t\t\t\t\t\t\t\t<FieldValueText>\n\t\t\t\t\t\t\t\t\t{app.account?.email\n\t\t\t\t\t\t\t\t\t\t? shouldRedactEmail\n\t\t\t\t\t\t\t\t\t\t\t? redactEmail(app.account.email)\n\t\t\t\t\t\t\t\t\t\t\t: app.account.email\n\t\t\t\t\t\t\t\t\t\t: \"No email added.\"}\n\n\t\t\t\t\t\t\t\t\t<FieldValueToggle onClick={() => setShouldRedactEmail(!shouldRedactEmail)}>\n\t\t\t\t\t\t\t\t\t\t{shouldRedactEmail ? \"Reveal\" : \"Hide\"}\n\t\t\t\t\t\t\t\t\t</FieldValueToggle>\n\t\t\t\t\t\t\t\t</FieldValueText>\n\t\t\t\t\t\t\t</FieldValue>\n\t\t\t\t\t\t</Row>\n\t\t\t\t\t</Field>\n\n\t\t\t\t\t<Field spacerTop>\n\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t<FieldTitle>Phone Number</FieldTitle>\n\n\t\t\t\t\t\t\t<FieldValue>\n\t\t\t\t\t\t\t\t<FieldValueText>No phone number added.</FieldValueText>\n\t\t\t\t\t\t\t</FieldValue>\n\t\t\t\t\t\t</Row>\n\t\t\t\t\t</Field>\n\t\t\t\t</UserInfoContainer>\n\n\t\t\t\t{hasUnsavedChangd && (\n\t\t\t\t\t<UnsavedChangesBar>\n\t\t\t\t\t\t<Text>You have unsaved changes.</Text>\n\t\t\t\t\t\t<UnsavedChangedActions>\n\t\t\t\t\t\t\t<Button palette=\"link\" onClick={discardChanges} disabled={loading}>\n\t\t\t\t\t\t\t\tDiscard\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button palette=\"primary\" disabled={loading} onClick={save}>\n\t\t\t\t\t\t\t\t{loading ? \"Saving...\" : \"Save\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</UnsavedChangedActions>\n\t\t\t\t\t</UnsavedChangesBar>\n\t\t\t\t)}\n\t\t\t</Content>\n\t\t</div>\n\t);\n}\n\nexport default observer(AccountSettingsPage);\n"],"names":["Content","styled","UserInfoContainer","Field","props","css","Row","FieldTitle","FieldValue","FieldValueText","FieldValueToggle","IconContainer","IconInput","FileInput","UnsavedChangesBar","UnsavedChangedActions","Text","AccountSettingsPage","app","useAppStore","shouldRedactEmail","setShouldRedactEmail","useState","selectedFile","setSelectedFile","fileInputRef","useRef","hasUnsavedChangd","setHasUnsavedChanged","loading","setLoading","redactEmail","email","username","domain","onAvatarChange","event","discardChanges","save","reader","payload","Routes","e","useEffect","jsx","SectionTitle","jsxs","Avatar","_a","_b","_c","Button","AccountSettingsPage$1","observer"],"mappings":"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"}