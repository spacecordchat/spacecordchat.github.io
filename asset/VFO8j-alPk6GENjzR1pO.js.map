{"version":3,"file":"VFO8j-alPk6GENjzR1pO.js","sources":["../../src/App.tsx"],"sourcesContent":["import { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { Route, Routes, useNavigate } from \"react-router-dom\";\nimport { AuthenticationGuard } from \"./components/guards/AuthenticationGuard\";\nimport LoginPage from \"./pages/LoginPage\";\nimport NotFoundPage from \"./pages/NotFound\";\nimport RegistrationPage from \"./pages/RegistrationPage\";\n\nimport { getTauriVersion, getVersion } from \"@tauri-apps/api/app\";\nimport { arch, locale, platform, version } from \"@tauri-apps/plugin-os\";\nimport { useNetworkState } from \"@uidotdev/usehooks\";\nimport { reaction } from \"mobx\";\nimport ErrorBoundary from \"./components/ErrorBoundary\";\nimport Loader from \"./components/Loader\";\nimport { UnauthenticatedGuard } from \"./components/guards/UnauthenticatedGuard\";\nimport useLogger from \"./hooks/useLogger\";\nimport AppPage from \"./pages/AppPage\";\nimport LogoutPage from \"./pages/LogoutPage\";\nimport ChannelPage from \"./pages/subpages/ChannelPage\";\nimport { Globals } from \"./utils/Globals\";\n// @ts-expect-error no types\nimport FPSStats from \"react-fps-stats\";\nimport { bannerController } from \"./controllers/banners\";\nimport { useAppStore } from \"./hooks/useAppStore\";\nimport { isTauri } from \"./utils/Utils\";\n\nfunction App() {\n\tconst app = useAppStore();\n\tconst logger = useLogger(\"App\");\n\tconst navigate = useNavigate();\n\tconst networkState = useNetworkState();\n\n\tReact.useEffect(() => {\n\t\t// Handles gateway connection/disconnection on token change\n\t\tconst dispose = reaction(\n\t\t\t() => app.token,\n\t\t\t(value) => {\n\t\t\t\tif (value) {\n\t\t\t\t\tapp.rest.setToken(value);\n\t\t\t\t\tif (app.gateway.readyState === WebSocket.CLOSED) {\n\t\t\t\t\t\tapp.setGatewayReady(false);\n\t\t\t\t\t\tapp.gateway.connect(Globals.routeSettings.gateway);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlogger.debug(\"Gateway connect called but socket is not closed\");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlogger.debug(\"user no longer authenticated\");\n\t\t\t\t\tif (app.gateway.readyState === WebSocket.OPEN) {\n\t\t\t\t\t\tapp.gateway.disconnect(1000, \"user is no longer authenticated\");\n\t\t\t\t\t}\n\n\t\t\t\t\tnavigate(\"/\");\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\n\t\tconst loadAsyncGlobals = async () => {\n\t\t\tconst [tauriVersion, appVersion, platformName, platformArch, platformVersion, platformLocale] =\n\t\t\t\tawait Promise.all([getTauriVersion(), getVersion(), platform(), arch(), version(), locale()]);\n\t\t\twindow.globals = {\n\t\t\t\ttauriVersion: tauriVersion,\n\t\t\t\tappVersion: appVersion,\n\t\t\t\tplatform: {\n\t\t\t\t\tname: platformName,\n\t\t\t\t\tarch: platformArch,\n\t\t\t\t\tversion: platformVersion,\n\t\t\t\t\tlocale: platformLocale,\n\t\t\t\t},\n\t\t\t};\n\t\t};\n\n\t\tisTauri && loadAsyncGlobals();\n\t\tGlobals.load();\n\t\tapp.loadSettings();\n\n\t\tlogger.debug(\"Loading complete\");\n\t\tapp.setAppLoading(false);\n\n\t\treturn dispose;\n\t}, []);\n\n\tReact.useEffect(() => {\n\t\tif (!networkState.online) {\n\t\t\tbannerController.push(\n\t\t\t\t{\n\t\t\t\t\ttype: \"offline\",\n\t\t\t\t},\n\t\t\t\t\"offline\",\n\t\t\t);\n\t\t} else {\n\t\t\t// only close if the current banner is the offline banner\n\t\t\tbannerController.remove(\"offline\");\n\t\t}\n\t}, [networkState]);\n\n\treturn (\n\t\t<ErrorBoundary section=\"app\">\n\t\t\t{app.fpsShown && <FPSStats />}\n\t\t\t<Loader>\n\t\t\t\t<Routes>\n\t\t\t\t\t<Route index path=\"/\" element={<AuthenticationGuard component={AppPage} />} />\n\t\t\t\t\t<Route path=\"/app\" element={<AuthenticationGuard component={AppPage} />} />\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/channels/:guildId/:channelId?\"\n\t\t\t\t\t\telement={<AuthenticationGuard component={ChannelPage} />}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route path=\"/login\" element={<UnauthenticatedGuard component={LoginPage} />} />\n\t\t\t\t\t<Route path=\"/register\" element={<UnauthenticatedGuard component={RegistrationPage} />} />\n\t\t\t\t\t<Route path=\"/logout\" element={<AuthenticationGuard component={LogoutPage} />} />\n\t\t\t\t\t<Route path=\"*\" element={<NotFoundPage />} />\n\t\t\t\t</Routes>\n\t\t\t</Loader>\n\t\t</ErrorBoundary>\n\t);\n}\n\nexport default observer(App);\n"],"names":["App","app","useAppStore","logger","useLogger","navigate","useNavigate","networkState","useNetworkState","React","dispose","reaction","value","Globals","isTauri","tauriVersion","appVersion","platformName","platformArch","platformVersion","platformLocale","getTauriVersion","getVersion","platform","arch","version","locale","bannerController","jsxs","ErrorBoundary","FPSStats","jsx","Loader","Routes","Route","AuthenticationGuard","AppPage","ChannelPage","UnauthenticatedGuard","LoginPage","RegistrationPage","LogoutPage","NotFoundPage","App$1","observer"],"mappings":"o2BA0BA,SAASA,GAAM,CACd,MAAMC,EAAMC,EAAY,EAClBC,EAASC,EAAU,KAAK,EACxBC,EAAWC,EAAY,EACvBC,EAAeC,EAAgB,EAErC,OAAAC,EAAM,UAAU,IAAM,CAErB,MAAMC,EAAUC,EACf,IAAMV,EAAI,MACTW,GAAU,CACNA,GACCX,EAAA,KAAK,SAASW,CAAK,EACnBX,EAAI,QAAQ,aAAe,UAAU,QACxCA,EAAI,gBAAgB,EAAK,EACzBA,EAAI,QAAQ,QAAQY,EAAQ,cAAc,OAAO,GAEjDV,EAAO,MAAM,iDAAiD,IAG/DA,EAAO,MAAM,8BAA8B,EACvCF,EAAI,QAAQ,aAAe,UAAU,MACpCA,EAAA,QAAQ,WAAW,IAAM,iCAAiC,EAG/DI,EAAS,GAAG,EACb,CAEF,EAiBA,OAAAS,IAfyB,SAAY,CAC9B,KAAA,CAACC,EAAcC,EAAYC,EAAcC,EAAcC,EAAiBC,CAAc,EAC3F,MAAM,QAAQ,IAAI,CAACC,EAAmB,EAAAC,EAAc,EAAAC,EAAY,EAAAC,EAAA,EAAQC,EAAQ,EAAGC,EAAO,CAAC,CAAC,EAC7F,OAAO,QAAU,CAChB,aAAAX,EACA,WAAAC,EACA,SAAU,CACT,KAAMC,EACN,KAAMC,EACN,QAASC,EACT,OAAQC,CAAA,CAEV,CACD,GAE4B,EAC5BP,EAAQ,KAAK,EACbZ,EAAI,aAAa,EAEjBE,EAAO,MAAM,kBAAkB,EAC/BF,EAAI,cAAc,EAAK,EAEhBS,CACR,EAAG,EAAE,EAELD,EAAM,UAAU,IAAM,CAChBF,EAAa,OASjBoB,EAAiB,OAAO,SAAS,EARhBA,EAAA,KAChB,CACC,KAAM,SACP,EACA,SACD,CAID,EACE,CAACpB,CAAY,CAAC,EAGhBqB,EAAA,KAACC,EAAc,CAAA,QAAQ,MACrB,SAAA,CAAI5B,EAAA,gBAAa6B,EAAS,CAAA,CAAA,EAC3BC,EAAA,IAACC,EACA,CAAA,SAAAJ,EAAAA,KAACK,EACA,CAAA,SAAA,CAACF,EAAAA,IAAAG,EAAA,CAAM,MAAK,GAAC,KAAK,IAAI,QAAUH,EAAAA,IAAAI,EAAA,CAAoB,UAAWC,CAAA,CAAS,CAAI,CAAA,EAC5EL,EAAAA,IAACG,GAAM,KAAK,OAAO,QAAUH,MAAAI,EAAA,CAAoB,UAAWC,CAAA,CAAS,CAAI,CAAA,EACzEL,EAAA,IAACG,EAAA,CACA,KAAK,iCACL,QAASH,EAAAA,IAACI,EAAoB,CAAA,UAAWE,CAAa,CAAA,CAAA,CACvD,EACAN,EAAAA,IAACG,GAAM,KAAK,SAAS,QAAUH,MAAAO,EAAA,CAAqB,UAAWC,CAAA,CAAW,CAAI,CAAA,EAC9ER,EAAAA,IAACG,GAAM,KAAK,YAAY,QAAUH,MAAAO,EAAA,CAAqB,UAAWE,CAAA,CAAkB,CAAI,CAAA,EACxFT,EAAAA,IAACG,GAAM,KAAK,UAAU,QAAUH,MAAAI,EAAA,CAAoB,UAAWM,CAAA,CAAY,CAAI,CAAA,QAC9EP,EAAM,CAAA,KAAK,IAAI,QAASH,EAAA,IAACW,IAAa,CAAI,CAAA,CAAA,CAAA,CAC5C,CACD,CAAA,CAAA,EACD,CAEF,CAEA,MAAeC,GAAAC,EAAS5C,CAAG"}