{"version":3,"file":"DOWywqZ_Ivn5M6H9zUP3.js","sources":["../../src/stores/AppStore.ts"],"sourcesContent":["import type { APIUser, Snowflake } from \"@spacebarchat/spacebar-api-types/v9\";\nimport { action, computed, makeAutoObservable, observable } from \"mobx\";\nimport secureLocalStorage from \"react-secure-storage\";\nimport { modalController } from \"../controllers/modals\";\nimport Logger from \"../utils/Logger\";\nimport REST from \"../utils/REST\";\nimport { isTauri } from \"../utils/Utils\";\nimport AccountStore from \"./AccountStore\";\nimport ChannelStore from \"./ChannelStore\";\nimport ExperimentsStore from \"./ExperimentsStore\";\nimport GatewayConnectionStore from \"./GatewayConnectionStore\";\nimport GuildStore from \"./GuildStore\";\nimport MessageQueue from \"./MessageQueue\";\nimport PresenceStore from \"./PresenceStore\";\nimport PrivateChannelStore from \"./PrivateChannelStore\";\nimport ReadStateStore from \"./ReadStateStore\";\nimport RoleStore from \"./RoleStore\";\nimport ThemeStore from \"./ThemeStore\";\nimport UpdaterStore from \"./UpdaterStore\";\nimport UserStore from \"./UserStore\";\nimport Channel from \"./objects/Channel\";\nimport Guild from \"./objects/Guild\";\n\n// dev thing to force toggle branding on auth pages for testing.\nexport const AUTH_NO_BRANDING = false;\n\nexport default class AppStore {\n\tprivate readonly logger: Logger = new Logger(\"AppStore\");\n\n\t// whether the gateway is ready\n\t@observable isGatewayReady = false;\n\t// whether the app is still loading\n\t@observable isAppLoading = true;\n\n\t@observable tokenLoaded = false;\n\t@observable token: string | null = null;\n\t@observable fpsShown: boolean = process.env.NODE_ENV === \"development\";\n\n\t// stores\n\t@observable theme: ThemeStore = new ThemeStore();\n\t@observable account: AccountStore | null = null;\n\t@observable gateway = new GatewayConnectionStore(this);\n\t@observable guilds = new GuildStore(this);\n\t@observable roles = new RoleStore(this);\n\t@observable channels = new ChannelStore(this);\n\t@observable users = new UserStore(this);\n\t@observable privateChannels = new PrivateChannelStore(this);\n\t@observable rest = new REST(this);\n\t@observable experiments = new ExperimentsStore();\n\t@observable presences = new PresenceStore(this);\n\t@observable readStateStore = new ReadStateStore(this);\n\t@observable queue = new MessageQueue(this);\n\t@observable updaterStore: UpdaterStore | null = null;\n\n\t@observable activeGuild: Guild | null = null;\n\t@observable activeGuildId: Snowflake | undefined | \"@me\" = \"@me\";\n\t@observable activeChannel: Channel | null = null;\n\t@observable activeChannelId: string | undefined = undefined;\n\t@observable memberListVisible: boolean = true;\n\n\tconstructor() {\n\t\tmakeAutoObservable(this);\n\n\t\tif (isTauri) {\n\t\t\tthis.updaterStore = new UpdaterStore(this);\n\t\t}\n\n\t\t// bind this in toggleMemberList\n\t\tthis.toggleMemberList = this.toggleMemberList.bind(this);\n\t\t// bind this in windowToggleFps\n\t\tthis.windowToggleFps = this.windowToggleFps.bind(this);\n\t\twindow.windowToggleFps = this.windowToggleFps;\n\t}\n\n\t@action\n\tsetGatewayReady(value: boolean) {\n\t\tthis.isGatewayReady = value;\n\t}\n\n\t@action\n\tsetAppLoading(value: boolean) {\n\t\tthis.isAppLoading = value;\n\t}\n\n\t@action\n\tsetUser(user: APIUser) {\n\t\tthis.account = new AccountStore(user);\n\t}\n\n\t@computed\n\t/**\n\t * Whether the app is done loading and ready to be displayed\n\t */\n\tget isReady() {\n\t\treturn !this.isAppLoading && this.isGatewayReady;\n\t}\n\n\t@action\n\tsetActiveGuildId(id: Snowflake | undefined | \"@me\") {\n\t\tthis.activeGuildId = id;\n\n\t\t// try to resolve the guild\n\t\tthis.activeGuild = (id ? this.guilds.get(id) : null) ?? null;\n\t}\n\n\t@action\n\tsetActiveChannelId(id: string | undefined) {\n\t\tthis.activeChannelId = id;\n\n\t\t// try to resolve the channel\n\t\tthis.activeChannel = (id ? this.channels.get(id) : null) ?? null;\n\t}\n\n\t@action\n\ttoggleMemberList() {\n\t\tthis.memberListVisible = !this.memberListVisible;\n\t}\n\n\t@action\n\twindowToggleFps() {\n\t\tthis.setFpsShown(!this.fpsShown);\n\t}\n\n\t// stuff mainly for settings, really anything that uses local storage\n\n\t@action\n\tsetToken(token: string, save = false) {\n\t\tthis.token = token;\n\t\tthis.tokenLoaded = true;\n\t\tif (save) {\n\t\t\tsecureLocalStorage.setItem(\"token\", token);\n\t\t\tthis.logger.info(\"Token saved to storage\");\n\t\t}\n\t}\n\n\t@action\n\tloadToken() {\n\t\tconst token = secureLocalStorage.getItem(\"token\") as string | null;\n\n\t\tthis.tokenLoaded = true;\n\n\t\tif (token) {\n\t\t\tthis.logger.debug(\"Loaded token from storage.\");\n\t\t\tthis.setToken(token);\n\t\t} else {\n\t\t\tthis.logger.debug(\"No token found in storage.\");\n\t\t\tthis.setGatewayReady(true);\n\t\t}\n\t}\n\n\t@action\n\tlogout() {\n\t\tthis.token = null;\n\t\tthis.tokenLoaded = false;\n\t\tthis.isAppLoading = false;\n\t\tthis.isGatewayReady = true;\n\t\tsecureLocalStorage.clear();\n\t\tmodalController.closeAll();\n\t}\n\n\t@action\n\tsetFpsShown(value: boolean) {\n\t\tthis.fpsShown = value;\n\n\t\tsecureLocalStorage.setItem(\"fpsShown\", value);\n\t}\n\n\t@action\n\tloadFpsShown() {\n\t\tthis.fpsShown = (secureLocalStorage.getItem(\"fpsShown\") as boolean | null) ?? false;\n\t}\n\n\t@action\n\tsetUpdaterEnabled(value: boolean) {\n\t\tthis.updaterStore?.setEnabled(value);\n\n\t\tsecureLocalStorage.setItem(\"updaterEnabled\", value);\n\t}\n\n\t@action\n\tloadUpdaterEnabled() {\n\t\tthis.updaterStore?.setEnabled((secureLocalStorage.getItem(\"updaterEnabled\") as boolean | null) ?? true);\n\t}\n\n\t@action\n\tloadSettings() {\n\t\tthis.loadFpsShown();\n\t\tthis.loadToken();\n\t\tthis.loadUpdaterEnabled();\n\t}\n}\n"],"names":["AppStore","__publicField","Logger","ThemeStore","GatewayConnectionStore","GuildStore","RoleStore","ChannelStore","UserStore","PrivateChannelStore","REST","ExperimentsStore","PresenceStore","ReadStateStore","MessageQueue","makeAutoObservable","isTauri","UpdaterStore","value","user","AccountStore","id","token","save","secureLocalStorage","modalController","_a","__decorateClass","observable","action","computed"],"mappings":"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"}