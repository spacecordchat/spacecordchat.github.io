{"version":3,"file":"C9rMTH335XSSlGfJ_rKZ.js","sources":["../../src/components/markdown/Mention.tsx"],"sourcesContent":["import React, { memo } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { ContextMenuContext } from \"../../contexts/ContextMenuContext\";\nimport { useAppStore } from \"../../hooks/useAppStore\";\nimport Channel from \"../../stores/objects/Channel\";\nimport Role from \"../../stores/objects/Role\";\nimport User from \"../../stores/objects/User\";\nimport { hexToRGB, rgbToHsl } from \"../../utils/Utils\";\nimport Floating from \"../floating/Floating\";\nimport FloatingTrigger from \"../floating/FloatingTrigger\";\n\nconst MentionText = styled.span<{ color?: string; withHover?: boolean }>`\n\tpadding: 0 2px;\n\tborder-radius: 4px;\n\tbackground-color: hsl(${(props) => props.color ?? \"var(--primary-hsl)\"} / 0.3);\n\tuser-select: ${(props) => (props.withHover ? \"none\" : \"inherit\")};\n\n\t${(props) =>\n\t\tprops.withHover &&\n\t\t`\n\t\t&:hover {\n\t\t\tbackground-color: hsl(${props.color ?? \"var(--primary-hsl)\"} / 0.5);\n\t\t\tcursor: pointer;\n\t\t}\n\t`}\n`;\n\ninterface MentionProps {\n\tid: string;\n}\nfunction UserMention({ id }: MentionProps) {\n\tconst app = useAppStore();\n\tconst [user, setUser] = React.useState<User | null>(null);\n\tconst contextMenu = React.useContext(ContextMenuContext);\n\n\tReact.useEffect(() => {\n\t\tconst getUser = async () => {\n\t\t\tconst resolvedUser = await app.users.resolve(id);\n\t\t\tsetUser(resolvedUser ?? null);\n\t\t};\n\n\t\tgetUser();\n\t}, [id]);\n\n\tif (!user) return <MentionText>@{id}</MentionText>;\n\n\treturn (\n\t\t<Floating\n\t\t\ttype=\"userPopout\"\n\t\t\tplacement=\"right\"\n\t\t\tprops={{\n\t\t\t\tuser,\n\t\t\t}}\n\t\t>\n\t\t\t<FloatingTrigger>\n\t\t\t\t<MentionText withHover onContextMenu={(e) => contextMenu.onContextMenu(e, { type: \"user\", user })}>\n\t\t\t\t\t@{user.username}\n\t\t\t\t</MentionText>\n\t\t\t</FloatingTrigger>\n\t\t</Floating>\n\t);\n}\n\nfunction ChannelMention({ id }: MentionProps) {\n\tconst app = useAppStore();\n\tconst [channel, setChannel] = React.useState<Channel | null>(null);\n\tconst navigate = useNavigate();\n\tconst contextMenu = React.useContext(ContextMenuContext);\n\n\tconst onClick = () => {\n\t\tif (!channel) return;\n\t\tif (!channel.isGuildTextChannel) return;\n\t\tnavigate(`/channels/${channel.guildId}/${channel.id}`);\n\t};\n\n\tReact.useEffect(() => {\n\t\tconst channel = app.channels.get(id);\n\t\tif (channel) setChannel(channel);\n\t}, [id]);\n\n\tif (!channel) return <MentionText>#{id}</MentionText>;\n\n\treturn (\n\t\t<MentionText\n\t\t\twithHover\n\t\t\tonClick={onClick}\n\t\t\tonContextMenu={(e) => contextMenu.onContextMenu(e, { type: \"channelMention\", channel })}\n\t\t>\n\t\t\t#{channel.name}\n\t\t</MentionText>\n\t);\n}\n\nfunction RoleMention({ id }: MentionProps) {\n\tconst app = useAppStore();\n\tconst [role, setRole] = React.useState<Role | null>(null);\n\tconst [color, setColor] = React.useState<string | undefined>(undefined);\n\n\tReact.useEffect(() => {\n\t\tconst role = app.roles.get(id);\n\t\tif (role) setRole(role);\n\t}, [id]);\n\n\tReact.useEffect(() => {\n\t\tif (!role?.color) return;\n\t\tif (role.color === \"#000000\") return; // TODO: why the fk do we use black as the default color???\n\t\tconst rgb = hexToRGB(role.color);\n\t\tif (!rgb) return;\n\n\t\tsetColor(rgbToHsl(rgb.r, rgb.g, rgb.b));\n\t}, [role]);\n\n\tif (!role) return <MentionText>@unknown-role</MentionText>;\n\n\treturn (\n\t\t<MentionText color={color} withHover>\n\t\t\t@{role.name}\n\t\t</MentionText>\n\t);\n}\n\nfunction CustomMention({ id }: MentionProps) {\n\treturn <MentionText>{id}</MentionText>;\n}\n\ninterface Props {\n\ttype: \"role\" | \"user\" | \"channel\" | \"text\";\n\tid: string;\n}\n\nfunction Mention({ type, id }: Props) {\n\tif (type === \"role\") return <RoleMention id={id} />;\n\tif (type === \"user\") return <UserMention id={id} />;\n\tif (type === \"channel\") return <ChannelMention id={id} />;\n\tif (type === \"text\") return <CustomMention id={id} />;\n\treturn null;\n}\n\nexport default memo(Mention);\n"],"names":["MentionText","styled","props","UserMention","id","app","useAppStore","user","setUser","React","contextMenu","ContextMenuContext","resolvedUser","jsx","Floating","FloatingTrigger","jsxs","e","ChannelMention","channel","setChannel","navigate","useNavigate","onClick","RoleMention","role","setRole","color","setColor","rgb","hexToRGB","rgbToHsl","CustomMention","Mention","type","memo"],"mappings":"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"}