{"version":3,"file":"D_x2BrCRu1fJOVoTkM-b.js","sources":["../../src/stores/GuildMemberStore.ts"],"sourcesContent":["import type { Snowflake } from \"@spacebarchat/spacebar-api-types/globals\";\nimport { type APIGuildMember } from \"@spacebarchat/spacebar-api-types/v9\";\nimport { ObservableMap, action, computed, makeObservable, observable } from \"mobx\";\nimport { APIUserProfile } from \"../utils/interfaces/api\";\nimport AppStore from \"./AppStore\";\nimport Guild from \"./objects/Guild\";\nimport GuildMember from \"./objects/GuildMember\";\n\nexport default class GuildMemberStore {\n\tprivate readonly app: AppStore;\n\tprivate readonly guild: Guild;\n\n\t@observable private readonly members = new ObservableMap<Snowflake, GuildMember>();\n\n\tconstructor(app: AppStore, guild: Guild) {\n\t\tthis.app = app;\n\t\tthis.guild = guild;\n\n\t\tmakeObservable(this);\n\t}\n\n\t@action\n\tadd(member: APIGuildMember) {\n\t\tif (!member.user) {\n\t\t\tthrow new Error(\"Member does not have a user\");\n\t\t}\n\t\tif (this.members.has(member.user.id)) {\n\t\t\treturn;\n\t\t}\n\t\tconst m = new GuildMember(this.app, this.guild, member);\n\t\tthis.members.set(member.user.id, m);\n\t\treturn m;\n\t}\n\n\t@action\n\taddAll(members: APIGuildMember[]) {\n\t\tmembers.forEach((member) => this.add(member));\n\t}\n\n\t@action\n\tremove(id: Snowflake) {\n\t\tthis.members.delete(id);\n\t}\n\n\t@action\n\tupdate(member: APIGuildMember) {\n\t\tif (!member.user) {\n\t\t\tthrow new Error(\"Member does not have a user\");\n\t\t}\n\t\tthis.members.get(member.user.id)?.update(member);\n\t}\n\n\tget(id: Snowflake) {\n\t\treturn this.members.get(id);\n\t}\n\n\thas(id: Snowflake) {\n\t\treturn this.members.has(id);\n\t}\n\n\tasList() {\n\t\treturn Array.from(this.members.values());\n\t}\n\n\tget size() {\n\t\treturn this.members.size;\n\t}\n\n\t@computed\n\tget me() {\n\t\tconst meId = this.app.account?.id;\n\t\tif (!meId) return null;\n\t\treturn this.members.get(meId);\n\t}\n\n\t@action\n\tasync resolve(id: Snowflake, fetch: boolean = false): Promise<GuildMember | undefined> {\n\t\tif (this.has(id) && !fetch) return this.get(id);\n\t\tconst profile = await this.app.rest.get<APIUserProfile>(`/users/${id}/profile`, {\n\t\t\tguild_id: this.guild.id,\n\t\t});\n\t\tif (!profile.guild_member) return undefined;\n\t\tprofile.guild_member.user = profile.user;\n\n\t\treturn this.add(profile.guild_member);\n\t}\n}\n"],"names":["GuildMemberStore","app","guild","__publicField","ObservableMap","makeObservable","member","m","GuildMember","members","id","_a","meId","fetch","profile","__decorateClass","observable","action","computed"],"mappings":"ieAQA,MAAqBA,CAAiB,CAMrC,YAAYC,EAAeC,EAAc,CALxBC,EAAA,YACAA,EAAA,cAEYA,EAAA,eAAU,IAAIC,GAG1C,KAAK,IAAMH,EACX,KAAK,MAAQC,EAEbG,EAAe,IAAI,CAAA,CAIpB,IAAIC,EAAwB,CACvB,GAAA,CAACA,EAAO,KACL,MAAA,IAAI,MAAM,6BAA6B,EAE9C,GAAI,KAAK,QAAQ,IAAIA,EAAO,KAAK,EAAE,EAClC,OAED,MAAMC,EAAI,IAAIC,EAAY,KAAK,IAAK,KAAK,MAAOF,CAAM,EACtD,YAAK,QAAQ,IAAIA,EAAO,KAAK,GAAIC,CAAC,EAC3BA,CAAA,CAIR,OAAOE,EAA2B,CACjCA,EAAQ,QAASH,GAAW,KAAK,IAAIA,CAAM,CAAC,CAAA,CAI7C,OAAOI,EAAe,CAChB,KAAA,QAAQ,OAAOA,CAAE,CAAA,CAIvB,OAAOJ,EAAwB,OAC1B,GAAA,CAACA,EAAO,KACL,MAAA,IAAI,MAAM,6BAA6B,GAE9CK,EAAA,KAAK,QAAQ,IAAIL,EAAO,KAAK,EAAE,IAA/B,MAAAK,EAAkC,OAAOL,EAAM,CAGhD,IAAII,EAAe,CACX,OAAA,KAAK,QAAQ,IAAIA,CAAE,CAAA,CAG3B,IAAIA,EAAe,CACX,OAAA,KAAK,QAAQ,IAAIA,CAAE,CAAA,CAG3B,QAAS,CACR,OAAO,MAAM,KAAK,KAAK,QAAQ,QAAQ,CAAA,CAGxC,IAAI,MAAO,CACV,OAAO,KAAK,QAAQ,IAAA,CAIrB,IAAI,IAAK,OACF,MAAAE,GAAOD,EAAA,KAAK,IAAI,UAAT,YAAAA,EAAkB,GAC3B,OAACC,EACE,KAAK,QAAQ,IAAIA,CAAI,EADV,IACU,CAI7B,MAAM,QAAQF,EAAeG,EAAiB,GAAyC,CAClF,GAAA,KAAK,IAAIH,CAAE,GAAK,CAACG,EAAO,OAAO,KAAK,IAAIH,CAAE,EACxC,MAAAI,EAAU,MAAM,KAAK,IAAI,KAAK,IAAoB,UAAUJ,CAAE,WAAY,CAC/E,SAAU,KAAK,MAAM,EAAA,CACrB,EACG,GAACI,EAAQ,aACL,OAAAA,EAAA,aAAa,KAAOA,EAAQ,KAE7B,KAAK,IAAIA,EAAQ,YAAY,CAAA,CAEtC,CA1E8BC,EAAA,CAA5BC,CAAA,EAJmBhB,EAIS,UAAA,UAAA,CAAA,EAU7Be,EAAA,CADCE,CAAA,EAbmBjB,EAcpB,UAAA,MAAA,CAAA,EAaAe,EAAA,CADCE,CAAA,EA1BmBjB,EA2BpB,UAAA,SAAA,CAAA,EAKAe,EAAA,CADCE,CAAA,EA/BmBjB,EAgCpB,UAAA,SAAA,CAAA,EAKAe,EAAA,CADCE,CAAA,EApCmBjB,EAqCpB,UAAA,SAAA,CAAA,EAwBIe,EAAA,CADHG,CAAA,EA5DmBlB,EA6DhB,UAAA,KAAA,CAAA,EAOEe,EAAA,CADLE,CAAA,EAnEmBjB,EAoEd,UAAA,UAAA,CAAA"}