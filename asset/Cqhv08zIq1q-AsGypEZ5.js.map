{"version":3,"file":"Cqhv08zIq1q-AsGypEZ5.js","sources":["../../src/stores/objects/Guild.ts"],"sourcesContent":["import type { Snowflake } from \"@spacebarchat/spacebar-api-types/globals\";\nimport {\n\tChannelType,\n\tRESTPutAPIGuildBanJSONBody,\n\tRESTPutAPIGuildBanResult,\n\tRoutes,\n\ttype APIChannel,\n\ttype APIGuild,\n\ttype GatewayGuild,\n\ttype GatewayGuildMemberListUpdateDispatchData,\n} from \"@spacebarchat/spacebar-api-types/v9\";\nimport { ObservableMap, ObservableSet, action, computed, makeObservable, observable } from \"mobx\";\nimport { compareChannels } from \"../../utils/Utils\";\nimport AppStore from \"../AppStore\";\nimport GuildMemberListStore from \"../GuildMemberListStore\";\nimport GuildMemberStore from \"../GuildMemberStore\";\n\nexport default class Guild {\n\tprivate readonly app: AppStore;\n\n\tid: Snowflake;\n\tjoinedAt: string;\n\t@observable threads: unknown[];\n\t@observable stickers: unknown[]; // TODO:\n\t@observable stageInstances: unknown[]; // TODO:\n\t@observable roles_: ObservableSet<Snowflake>;\n\t@observable memberCount: number;\n\t@observable lazy: boolean;\n\t@observable large: boolean;\n\t@observable guildScheduledEvents: unknown[]; // TODO:\n\t@observable emojis: unknown[]; // TODO:\n\t@observable channels_: ObservableSet<Snowflake>;\n\t@observable name: string;\n\t@observable description: string | null = null;\n\t@observable icon: string | null = null;\n\t@observable splash: string | null = null;\n\t@observable banner: string | null = null;\n\t@observable features: string[];\n\t@observable preferredLocale: string;\n\t@observable ownerId: Snowflake;\n\t@observable applicationId: Snowflake | null = null;\n\t@observable afkChannelId: Snowflake | null = null;\n\t@observable afkTimeout: number;\n\t@observable systemChannelId: Snowflake | null = null;\n\t@observable verificationLevel: number;\n\t@observable explicitContentFilter: number;\n\t@observable defaultMessageNotifications: number;\n\t@observable mfaLevel: number;\n\t@observable vanityUrlCode: string | null = null;\n\t@observable premiumTier: number;\n\t//   @observable premium_progress_bar_enabled: boolean\n\t@observable systemChannelFlags: number;\n\t@observable discoverySplash: string | null = null;\n\t@observable rulesChannelId: Snowflake | null = null;\n\t@observable publicUpdatesChannelId: Snowflake | null = null;\n\t@observable maxVideoChannelUsers: number;\n\t@observable maxMembers: number;\n\t@observable nsfwLevel: number;\n\t@observable hubType: number | null = null;\n\t@observable members: GuildMemberStore;\n\t@observable memberLists: ObservableMap<string, GuildMemberListStore> = new ObservableMap();\n\n\tconstructor(app: AppStore, data: GatewayGuild) {\n\t\tthis.app = app;\n\t\tthis.roles_ = new ObservableSet();\n\t\tthis.channels_ = new ObservableSet();\n\t\tthis.members = new GuildMemberStore(app, this);\n\n\t\tthis.id = data.id;\n\t\tthis.joinedAt = data.joined_at;\n\t\tthis.threads = data.threads;\n\t\tthis.stickers = data.stickers;\n\t\tthis.stageInstances = data.stage_instances;\n\t\tthis.memberCount = data.member_count;\n\t\tthis.lazy = data.lazy;\n\t\tthis.large = data.large;\n\t\tthis.guildScheduledEvents = data.guild_scheduled_events;\n\t\tthis.emojis = data.emojis;\n\t\tthis.name = data.properties?.name;\n\t\tthis.description = data.properties?.description;\n\t\tthis.icon = data.properties?.icon;\n\t\tthis.splash = data.properties?.splash;\n\t\tthis.banner = data.properties?.banner;\n\t\tthis.features = data.properties?.features;\n\t\tthis.preferredLocale = data.properties?.preferred_locale;\n\t\tthis.ownerId = data.properties?.owner_id;\n\t\tthis.applicationId = data.properties?.application_id;\n\t\tthis.afkChannelId = data.properties?.afk_channel_id;\n\t\tthis.afkTimeout = data.properties?.afk_timeout;\n\t\tthis.systemChannelId = data.properties?.system_channel_id;\n\t\tthis.verificationLevel = data.properties?.verification_level;\n\t\tthis.explicitContentFilter = data.properties?.explicit_content_filter;\n\t\tthis.defaultMessageNotifications = data.properties?.default_message_notifications;\n\t\tthis.mfaLevel = data.properties?.mfa_level;\n\t\tthis.vanityUrlCode = data.properties?.vanity_url_code;\n\t\tthis.premiumTier = data.properties?.premium_tier;\n\t\t// this.premium_progress_bar_enabled = data.properties?.premium_progress_bar_enabled; // FIXME: missing\n\t\tthis.systemChannelFlags = data.properties?.system_channel_flags;\n\t\tthis.discoverySplash = data.properties?.discovery_splash;\n\t\tthis.rulesChannelId = data.properties?.rules_channel_id;\n\t\tthis.publicUpdatesChannelId = data.properties?.public_updates_channel_id;\n\t\tthis.maxVideoChannelUsers = data.properties?.max_video_channel_users!;\n\t\tthis.maxMembers = data.properties?.max_members!;\n\t\tthis.nsfwLevel = data.properties?.nsfw_level;\n\t\tthis.hubType = data.properties?.hub_type;\n\n\t\tapp.roles.addAll(data.roles);\n\t\tapp.channels.addAll(data.channels);\n\n\t\tdata.roles?.forEach((role) => this.roles_.add(role.id));\n\t\tdata.channels?.forEach((channel) => this.channels_.add(channel.id));\n\n\t\tmakeObservable(this);\n\t}\n\n\t@action\n\tupdate(data: APIGuild | GatewayGuild) {\n\t\tif (\"properties\" in data) {\n\t\t\tObject.assign(this, { ...data, ...data.properties });\n\t\t\treturn;\n\t\t}\n\n\t\tObject.assign(this, data);\n\t}\n\n\t@action\n\tupdateMemberList(data: GatewayGuildMemberListUpdateDispatchData) {\n\t\tconst store = this.memberLists.get(data.id);\n\t\tif (store) {\n\t\t\tstore.update(data);\n\t\t} else {\n\t\t\tthis.memberLists.set(data.id, new GuildMemberListStore(this.app, this, data));\n\t\t}\n\t}\n\n\tgetMemberList(id: string): GuildMemberListStore | undefined {\n\t\treturn this.memberLists.get(id);\n\t}\n\n\t@computed\n\tget acronym() {\n\t\treturn this.name\n\t\t\t?.split(\" \")\n\t\t\t.map((word) => word.substring(0, 1))\n\t\t\t.join(\"\");\n\t}\n\n\t@computed\n\tget channels() {\n\t\tlet guildChannels = this.app.channels.all.filter((channel) => this.channels_.has(channel.id));\n\t\tconst topLevelChannels = guildChannels.filter((channel) => !channel.parentId);\n\t\tconst sortedChannels = topLevelChannels\n\t\t\t.sort(compareChannels)\n\t\t\t.flatMap((topLevelChannel) => [\n\t\t\t\ttopLevelChannel,\n\t\t\t\t...guildChannels.filter((channel) => channel.parentId === topLevelChannel.id).sort(compareChannels),\n\t\t\t]);\n\t\treturn sortedChannels;\n\t}\n\n\t@computed\n\tget roles() {\n\t\treturn this.app.roles.all.filter((role) => this.roles_.has(role.id));\n\t}\n\n\t@action\n\taddChannel(data: APIChannel) {\n\t\tthis.app.channels.add(data);\n\t\tthis.channels_.add(data.id);\n\t}\n\n\t@action\n\tupdateChannel(data: APIChannel) {\n\t\tthis.app.channels.update(data);\n\t}\n\n\t@action\n\tremoveChannel(id: Snowflake) {\n\t\tthis.app.channels.remove(id);\n\t\tthis.channels_.delete(id);\n\t}\n\n\t@action\n\tasync kickMember(id: Snowflake, reason?: string) {\n\t\treturn this.app.rest.delete(\n\t\t\tRoutes.guildMember(this.id, id),\n\t\t\t{},\n\t\t\treason\n\t\t\t\t? {\n\t\t\t\t\t\t\"X-Audit-Log-Reason\": reason,\n\t\t\t\t\t}\n\t\t\t\t: {},\n\t\t);\n\t}\n\n\t@action\n\tasync banMember(id: Snowflake, reason?: string, deleteMessageSeconds?: number) {\n\t\treturn this.app.rest.put<RESTPutAPIGuildBanJSONBody, RESTPutAPIGuildBanResult>(\n\t\t\tRoutes.guildBan(this.id, id),\n\t\t\t{\n\t\t\t\tdelete_message_seconds: deleteMessageSeconds,\n\t\t\t},\n\t\t\t{},\n\t\t\treason\n\t\t\t\t? {\n\t\t\t\t\t\t\"X-Audit-Log-Reason\": reason,\n\t\t\t\t\t}\n\t\t\t\t: {},\n\t\t);\n\t}\n}\n"],"names":["Guild","app","data","__publicField","ObservableMap","ObservableSet","GuildMemberStore","_a","_b","_c","_d","_e","_f","_g","_h","_i","_j","_k","_l","_m","_n","_o","_p","_q","_r","_s","_t","_u","_v","_w","_x","_y","_z","_A","role","_B","channel","makeObservable","store","GuildMemberListStore","id","word","guildChannels","compareChannels","topLevelChannel","reason","Routes","deleteMessageSeconds","__decorateClass","observable","action","computed"],"mappings":"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"}