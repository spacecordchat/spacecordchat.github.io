{"version":3,"file":"B1wKGbCXAWMo9qEz2RIA.js","sources":["../../src/components/messaging/MessageAttachment.tsx"],"sourcesContent":["import { APIAttachment } from \"@spacebarchat/spacebar-api-types/v9\";\nimport styled from \"styled-components\";\nimport { modalController } from \"../../controllers/modals\";\nimport useLogger from \"../../hooks/useLogger\";\nimport { getFileDetails, zoomFit } from \"../../utils/Utils\";\nimport Audio from \"../media/Audio\";\nimport File from \"../media/File\";\nimport Video from \"../media/Video\";\n\nconst MAX_ATTACHMENT_HEIGHT = 350;\n\nfunction adjustDimensions(width: number, height: number): { adjustedWidth: number; adjustedHeight: number } {\n\tconst aspectRatio = width / height;\n\n\tlet adjustedWidth: number = width * aspectRatio;\n\tlet adjustedHeight: number = height * aspectRatio;\n\n\t// Ensure the adjusted height does not exceed the maximum height\n\tif (adjustedHeight > MAX_ATTACHMENT_HEIGHT) {\n\t\tconst scale = MAX_ATTACHMENT_HEIGHT / adjustedHeight;\n\t\tadjustedWidth *= scale;\n\t\tadjustedHeight = MAX_ATTACHMENT_HEIGHT;\n\t}\n\n\treturn { adjustedWidth: Math.floor(adjustedWidth), adjustedHeight: Math.floor(adjustedHeight) };\n}\n\nconst Attachment = styled.div<{ withPointer?: boolean }>`\n\tcursor: ${(props) => (props.withPointer ? \"pointer\" : \"default\")};\n\tpadding: 2px 0;\n`;\n\nconst Image = styled.img`\n\tborder-radius: 4px;\n\twidth: 100%;\n\theight: auto;\n`;\n\ninterface AttachmentProps {\n\tattachment: APIAttachment;\n}\n\nexport default function MessageAttachment({ attachment }: AttachmentProps) {\n\tconst logger = useLogger(\"MessageAttachment\");\n\n\tconst url = attachment.proxy_url && attachment.proxy_url.length > 0 ? attachment.proxy_url : attachment.url;\n\n\tconst details = getFileDetails(attachment);\n\tlet finalElement: JSX.Element = <></>;\n\tif (details.isImage && details.isEmbeddable) {\n\t\tconst width = attachment.width!;\n\t\tconst height = attachment.height!;\n\t\tconst { adjustedWidth, adjustedHeight } = adjustDimensions(width, height);\n\n\t\tfinalElement = (\n\t\t\t<Image\n\t\t\t\tsrc={url}\n\t\t\t\talt={attachment.filename}\n\t\t\t\tloading=\"lazy\"\n\t\t\t\tstyle={{ maxWidth: adjustedWidth, maxHeight: adjustedHeight }}\n\t\t\t/>\n\t\t);\n\t} else if (details.isVideo && details.isEmbeddable) {\n\t\tfinalElement = <Video attachment={attachment} />;\n\t} else if (details.isAudio && details.isEmbeddable) {\n\t\tfinalElement = <Audio attachment={attachment} />;\n\t} else {\n\t\tfinalElement = <File attachment={attachment} />;\n\t}\n\n\treturn (\n\t\t<Attachment\n\t\t\twithPointer={attachment.content_type?.startsWith(\"image\")}\n\t\t\tkey={attachment.id}\n\t\t\tonClick={() => {\n\t\t\t\tif (!attachment.content_type?.startsWith(\"image\")) return;\n\t\t\t\tconst { width, height } = zoomFit(attachment.width!, attachment.height!);\n\t\t\t\tmodalController.push({\n\t\t\t\t\ttype: \"image_viewer\",\n\t\t\t\t\tattachment,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t});\n\t\t\t}}\n\t\t>\n\t\t\t{finalElement}\n\t\t</Attachment>\n\t);\n}\n"],"names":["MAX_ATTACHMENT_HEIGHT","adjustDimensions","width","height","aspectRatio","adjustedWidth","adjustedHeight","scale","Attachment","styled","props","Image","MessageAttachment","attachment","url","details","getFileDetails","finalElement","jsx","Fragment","Video","Audio","File","_a","zoomFit","modalController"],"mappings":"oUASA,MAAMA,EAAwB,IAE9B,SAASC,EAAiBC,EAAeC,EAAmE,CAC3G,MAAMC,EAAcF,EAAQC,EAE5B,IAAIE,EAAwBH,EAAQE,EAChCE,EAAyBH,EAASC,EAGtC,GAAIE,EAAiBN,EAAuB,CAC3C,MAAMO,EAAQP,EAAwBM,EACrBD,GAAAE,EACAD,EAAAN,CAAA,CAGX,MAAA,CAAE,cAAe,KAAK,MAAMK,CAAa,EAAG,eAAgB,KAAK,MAAMC,CAAc,CAAE,CAC/F,CAEA,MAAME,EAAaC,EAAO;AAAA,WACdC,GAAWA,EAAM,YAAc,UAAY,SAAU;AAAA;AAAA,EAI3DC,EAAQF,EAAO;AAAA;AAAA;AAAA;AAAA,EAUG,SAAAG,EAAkB,CAAE,WAAAC,GAA+B,OAGpE,MAAAC,EAAMD,EAAW,WAAaA,EAAW,UAAU,OAAS,EAAIA,EAAW,UAAYA,EAAW,IAElGE,EAAUC,EAAeH,CAAU,EACzC,IAAII,EAA8BC,EAAAA,IAAAC,EAAA,SAAA,EAAA,EAC9B,GAAAJ,EAAQ,SAAWA,EAAQ,aAAc,CAC5C,MAAMb,EAAQW,EAAW,MACnBV,EAASU,EAAW,OACpB,CAAE,cAAAR,EAAe,eAAAC,CAAA,EAAmBL,EAAiBC,EAAOC,CAAM,EAGvEc,EAAAC,EAAA,IAACP,EAAA,CACA,IAAKG,EACL,IAAKD,EAAW,SAChB,QAAQ,OACR,MAAO,CAAE,SAAUR,EAAe,UAAWC,CAAe,CAAA,CAC7D,CAES,MAAAS,EAAQ,SAAWA,EAAQ,aACtBE,EAAAC,EAAA,IAACE,GAAM,WAAAP,CAAwB,CAAA,EACpCE,EAAQ,SAAWA,EAAQ,aACtBE,EAAAC,EAAA,IAACG,GAAM,WAAAR,CAAwB,CAAA,EAE/BI,EAAAC,EAAA,IAACI,GAAK,WAAAT,CAAwB,CAAA,EAI7C,OAAAK,EAAA,IAACV,EAAA,CACA,aAAae,EAAAV,EAAW,eAAX,YAAAU,EAAyB,WAAW,SAEjD,QAAS,IAAM,OACd,GAAI,GAACA,EAAAV,EAAW,eAAX,MAAAU,EAAyB,WAAW,UAAU,OAC7C,KAAA,CAAE,MAAArB,EAAO,OAAAC,GAAWqB,EAAQX,EAAW,MAAQA,EAAW,MAAO,EACvEY,EAAgB,KAAK,CACpB,KAAM,eACN,WAAAZ,EACA,MAAAX,EACA,OAAAC,CAAA,CACA,CACF,EAEC,SAAAc,CAAA,EAZIJ,EAAW,EAajB,CAEF"}