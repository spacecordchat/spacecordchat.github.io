{"version":3,"file":"CkgDl1m3uVPR4CSpvgyi.js","sources":["../../src/components/messaging/EmbedMedia.tsx"],"sourcesContent":["// adapted from Revite\n// https://github.com/revoltchat/revite/blob/master/src/components/common/messaging/embed/Embed.tsx\n\nimport { APIEmbed, EmbedType } from \"@spacebarchat/spacebar-api-types/v9\";\nimport { modalController } from \"../../controllers/modals\";\nimport Icon from \"../Icon\";\nimport styles from \"./Embed.module.css\";\n\nfunction getScaledDimensions(originalWidth: number, originalHeight: number, maxWidth: number, maxHeight: number) {\n\tconst aspectRatio = originalWidth / originalHeight;\n\tlet newWidth = originalWidth;\n\tlet newHeight = originalHeight;\n\n\tif (newWidth > maxWidth) {\n\t\tnewWidth = maxWidth;\n\t\tnewHeight = newWidth / aspectRatio;\n\t}\n\n\tif (newHeight > maxHeight) {\n\t\tnewHeight = maxHeight;\n\t\tnewWidth = newHeight * aspectRatio;\n\t}\n\n\treturn { width: Math.round(newWidth), height: Math.round(newHeight) };\n}\nfunction shouldScaleImage(originalWidth: number, originalHeight: number, maxWidth: number, maxHeight: number) {\n\treturn originalWidth > maxWidth || originalHeight > maxHeight;\n}\n\ninterface Props {\n\tembed: APIEmbed;\n\twidth?: number;\n\theight?: number;\n\tthumbnail?: boolean;\n}\n\nfunction EmbedMedia({ embed, width, height, thumbnail }: Props) {\n\tlet maxWidth = 400;\n\tlet maxHeight = 300;\n\n\tif (!width || !height) {\n\t\tif (embed.video) {\n\t\t\twidth = embed.video.width;\n\t\t\theight = embed.video.height;\n\t\t} else if (embed.image) {\n\t\t\twidth = embed.image.width;\n\t\t\theight = embed.image.height;\n\t\t} else if (embed.thumbnail) {\n\t\t\tif (embed.type !== EmbedType.Image && embed.provider?.name !== \"GitHub\") {\n\t\t\t\tmaxWidth = 80;\n\t\t\t\tmaxHeight = 80;\n\t\t\t}\n\n\t\t\twidth = embed.thumbnail.width;\n\t\t\theight = embed.thumbnail.height;\n\t\t} else {\n\t\t\tconsole.log(\"No media size provided\");\n\t\t\twidth = 400;\n\t\t\theight = 300;\n\t\t}\n\t}\n\n\tconst originalWidth = width;\n\tconst originalHeight = height;\n\n\t// Scale image if it's too large\n\tif (shouldScaleImage(width!, height!, maxWidth, maxHeight)) {\n\t\tconst { width: newWidth, height: newHeight } = getScaledDimensions(width!, height!, maxWidth, maxHeight);\n\t\twidth = newWidth;\n\t\theight = newHeight;\n\t}\n\n\t// console.log(`Original size: ${originalWidth}x${originalHeight} - Scaled size: ${width}x${height}`);\n\n\tswitch (embed.provider?.name) {\n\t\tcase \"YouTube\": {\n\t\t\tif (!embed.video?.url) return null;\n\t\t\tconst url = embed.video.url;\n\n\t\t\treturn <iframe loading=\"lazy\" src={url} allowFullScreen style={{ height, width }} />;\n\t\t}\n\t\tcase \"Spotify\": {\n\t\t\tconst url = embed.url;\n\t\t\tif (!url) break;\n\t\t\t// extract type and id from url\n\t\t\tconst match = url.match(/https:\\/\\/open\\.spotify\\.com\\/(track|album|playlist)\\/([a-zA-Z0-9]+)/);\n\t\t\tif (!match) break;\n\t\t\tconst type = match[1];\n\t\t\tconst id = match[2];\n\n\t\t\treturn (\n\t\t\t\t<iframe\n\t\t\t\t\tstyle={{ width: \"400px\", height: \"80px\", borderRadius: 12 }}\n\t\t\t\t\tsrc={`https://open.spotify.com/embed/${type}/${id}`}\n\t\t\t\t\tframeBorder=\"0\"\n\t\t\t\t\tallow=\"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture\"\n\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t></iframe>\n\t\t\t);\n\t\t}\n\t\tcase \"Soundcloud\":\n\t\t\treturn (\n\t\t\t\t<iframe\n\t\t\t\t\tsrc={`https://w.soundcloud.com/player/?url=${encodeURIComponent(\n\t\t\t\t\t\tembed.url!,\n\t\t\t\t\t)}&color=%23FF7F50&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true`}\n\t\t\t\t\tframeBorder=\"0\"\n\t\t\t\t\tscrolling=\"no\"\n\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\tstyle={{ height }}\n\t\t\t\t/>\n\t\t\t);\n\t\t// not supported by the server\n\t\t// case \"Bandcamp\": {\n\t\t// \tconst url = embed.url;\n\t\t// \tif (!url) break;\n\t\t// \t// extract type and id from url\n\t\t// \tconst match = url.match(/https:\\/\\/([a-zA-Z0-9-]+)\\.bandcamp\\.com\\/(track|album|playlist)\\/([a-zA-Z0-9]+)/);\n\t\t// \tif (!match) break;\n\t\t// \tconst type = match[2];\n\t\t// \tconst id = match[3];\n\n\t\t// \treturn (\n\t\t// \t\t<iframe\n\t\t// \t\t\tsrc={`https://bandcamp.com/EmbeddedPlayer/${type.toLowerCase()}=${id}/size=large/bgcol=181a1b/linkcol=056cc4/tracklist=false/transparent=true/`}\n\t\t// \t\t\tseamless\n\t\t// \t\t\tloading=\"lazy\"\n\t\t// \t\t\tstyle={{ border: \"0\", height: \"42px\" }}\n\t\t// \t\t/>\n\t\t// \t);\n\t\t// }\n\t\tcase \"Streamable\": {\n\t\t\tconst url = embed.url;\n\t\t\tif (!url) break;\n\t\t\t// extract id from url\n\t\t\tconst match = url.match(/https:\\/\\/streamable\\.com\\/([a-zA-Z0-9]+)/);\n\t\t\tif (!match) break;\n\t\t\tconst id = match[1];\n\t\t\treturn (\n\t\t\t\t<iframe\n\t\t\t\t\tsrc={`https://streamable.com/e/${id}?quality=highest`}\n\t\t\t\t\tframeBorder=\"0\"\n\t\t\t\t\tallowFullScreen\n\t\t\t\t\tseamless\n\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\tstyle={{ height }}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t\tdefault: {\n\t\t\tif (embed.video && !thumbnail) {\n\t\t\t\tconst url = embed.video.url;\n\n\t\t\t\treturn (\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<video\n\t\t\t\t\t\t\tclassName={styles.embedImage}\n\t\t\t\t\t\t\tstyle={{ width, height }}\n\t\t\t\t\t\t\tsrc={url}\n\t\t\t\t\t\t\tloop={embed.type === EmbedType.GIFV}\n\t\t\t\t\t\t\tcontrols={embed.type !== EmbedType.GIFV}\n\t\t\t\t\t\t\tautoPlay={embed.type === EmbedType.GIFV}\n\t\t\t\t\t\t\tmuted={embed.type === EmbedType.GIFV ? true : undefined}\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tmodalController.push({\n\t\t\t\t\t\t\t\t\ttype: \"image_viewer\",\n\t\t\t\t\t\t\t\t\tattachment: embed.video!,\n\t\t\t\t\t\t\t\t\tisVideo: true,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{embed.type === EmbedType.GIFV && (\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className={styles.embedGifIconBg}></div>\n\t\t\t\t\t\t\t\t<Icon icon=\"mdiFileGifBox\" size={1} className={styles.embedGifIcon} />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t} else if (embed.image && !thumbnail) {\n\t\t\t\tconst url = embed.image.url;\n\n\t\t\t\treturn (\n\t\t\t\t\t<img\n\t\t\t\t\t\tclassName={styles.embedImage}\n\t\t\t\t\t\tsrc={url}\n\t\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tmodalController.push({\n\t\t\t\t\t\t\t\ttype: \"image_viewer\",\n\t\t\t\t\t\t\t\tattachment: embed.image!,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t} else if (embed.thumbnail) {\n\t\t\t\tconst url = embed.thumbnail.url;\n\n\t\t\t\treturn (\n\t\t\t\t\t<img\n\t\t\t\t\t\tclassName={thumbnail ? styles.embedThumbnail : styles.embedImage}\n\t\t\t\t\t\tsrc={url}\n\t\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\t\tstyle={{ height, width }}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tmodalController.push({\n\t\t\t\t\t\t\t\ttype: \"image_viewer\",\n\t\t\t\t\t\t\t\tattachment: embed.thumbnail!,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport default EmbedMedia;\n"],"names":["getScaledDimensions","originalWidth","originalHeight","maxWidth","maxHeight","aspectRatio","newWidth","newHeight","shouldScaleImage","EmbedMedia","embed","width","height","thumbnail","EmbedType","_a","_b","_c","url","jsx","match","type","id","styles","modalController","Icon"],"mappings":"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"}