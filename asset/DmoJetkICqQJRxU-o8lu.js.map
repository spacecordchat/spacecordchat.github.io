{"version":3,"file":"DmoJetkICqQJRxU-o8lu.js","sources":["../../src/stores/MessageQueue.ts"],"sourcesContent":["import type { APIMessage } from \"@spacebarchat/spacebar-api-types/v9\";\nimport { action, computed, makeAutoObservable, observable } from \"mobx\";\n\nimport type { IObservableArray } from \"mobx\";\nimport Snowflake from \"../utils/Snowflake\";\nimport AppStore from \"./AppStore\";\nimport type { QueuedMessageData } from \"./objects/QueuedMessage\";\nimport QueuedMessage, { QueuedMessageStatus } from \"./objects/QueuedMessage\";\n\nexport default class MessageQueue {\n\t@observable readonly messages: IObservableArray<QueuedMessage>;\n\n\tconstructor(private readonly app: AppStore) {\n\t\tthis.messages = observable.array([]);\n\n\t\tmakeAutoObservable(this);\n\t}\n\n\t@action\n\tadd(data: QueuedMessageData) {\n\t\tconst msg = new QueuedMessage(this.app, data);\n\t\tthis.messages.push(msg);\n\t\treturn msg;\n\t}\n\n\t@action\n\tremove(id: string) {\n\t\tconst message = this.messages.find((x) => x.id === id)!;\n\t\tthis.messages.remove(message);\n\t}\n\n\t@action\n\tsend(id: string) {\n\t\tconst message = this.messages.find((x) => x.id === id)!;\n\t\tmessage.status = QueuedMessageStatus.SENDING;\n\t}\n\n\t@computed\n\tget(channel: Snowflake) {\n\t\treturn this.messages.filter((message) => message.channel_id === channel);\n\t}\n\n\t@action\n\thandleIncomingMessage(message: APIMessage) {\n\t\tif (!message.nonce) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.get(message.channel_id).find((x) => x.id === message.nonce)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.remove(message.nonce.toString());\n\t}\n}\n"],"names":["MessageQueue","app","__publicField","observable","makeAutoObservable","data","msg","QueuedMessage","id","message","x","QueuedMessageStatus","channel","__decorateClass","action","computed"],"mappings":"geASA,MAAqBA,CAAa,CAGjC,YAA6BC,EAAe,CAFvBC,EAAA,iBAEQ,KAAA,IAAAD,EAC5B,KAAK,SAAWE,EAAW,MAAM,CAAA,CAAE,EAEnCC,EAAmB,IAAI,CAAA,CAIxB,IAAIC,EAAyB,CAC5B,MAAMC,EAAM,IAAIC,EAAc,KAAK,IAAKF,CAAI,EACvC,YAAA,SAAS,KAAKC,CAAG,EACfA,CAAA,CAIR,OAAOE,EAAY,CACZ,MAAAC,EAAU,KAAK,SAAS,KAAMC,GAAMA,EAAE,KAAOF,CAAE,EAChD,KAAA,SAAS,OAAOC,CAAO,CAAA,CAI7B,KAAKD,EAAY,CACV,MAAAC,EAAU,KAAK,SAAS,KAAMC,GAAMA,EAAE,KAAOF,CAAE,EACrDC,EAAQ,OAASE,EAAoB,OAAA,CAItC,IAAIC,EAAoB,CACvB,OAAO,KAAK,SAAS,OAAQH,GAAYA,EAAQ,aAAeG,CAAO,CAAA,CAIxE,sBAAsBH,EAAqB,CACrCA,EAAQ,OAGR,KAAK,IAAIA,EAAQ,UAAU,EAAE,KAAMC,GAAMA,EAAE,KAAOD,EAAQ,KAAK,GAIpE,KAAK,OAAOA,EAAQ,MAAM,SAAA,CAAU,CAAA,CAEtC,CA3CsBI,EAAA,CAApBV,CAAA,EADmBH,EACC,UAAA,WAAA,CAAA,EASrBa,EAAA,CADCC,CAAA,EATmBd,EAUpB,UAAA,MAAA,CAAA,EAOAa,EAAA,CADCC,CAAA,EAhBmBd,EAiBpB,UAAA,SAAA,CAAA,EAMAa,EAAA,CADCC,CAAA,EAtBmBd,EAuBpB,UAAA,OAAA,CAAA,EAMAa,EAAA,CADCE,CAAA,EA5BmBf,EA6BpB,UAAA,MAAA,CAAA,EAKAa,EAAA,CADCC,CAAA,EAjCmBd,EAkCpB,UAAA,wBAAA,CAAA"}