var u=Object.defineProperty;var c=(i,e,s)=>e in i?u(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var d=(i,e,s)=>c(i,typeof e!="symbol"?e+"":e,s);import{aE as w,w as h,aL as r,ai as l,aj as n}from"./DIBLJojdTQB51I2zM4gm.js";import{u as b}from"./DMCex30FeWvvThtDj-pY.js";var f=Object.defineProperty,D=Object.getOwnPropertyDescriptor,t=(i,e,s,p)=>{for(var o=p>1?void 0:p?D(e,s):e,g=i.length-1,U;g>=0;g--)(U=i[g])&&(o=(p?U(e,s,o):U(o))||o);return p&&o&&f(e,s,o),o};class a{constructor(e){d(this,"logger",b("UpdaterStore"));d(this,"initialized",!1);d(this,"enabled",!0);d(this,"checkingForUpdates",!1);d(this,"updateDownloading",!1);d(this,"updateDownloaded",!1);d(this,"updateAvailable",!1);d(this,"timer",null);this.app=e,this.logger.info("Initializing UpdaterStore"),w(this),(async()=>{await r("CHECKING_FOR_UPDATE",()=>{this.logger.debug("Checking for updates"),this.setCheckingForUpdates(!0),this.setUpdateAvailable(!1),this.setUpdateDownloading(!1),this.setUpdateDownloaded(!1)}),await r("UPDATE_AVAILABLE",()=>{this.logger.debug("Update available"),this.setCheckingForUpdates(!1),this.setUpdateAvailable(!0),this.setUpdateDownloading(!1),this.setUpdateDownloaded(!1)}),await r("UPDATE_NOT_AVAILABLE",()=>{this.logger.debug("Update not available"),this.setCheckingForUpdates(!1),this.setUpdateAvailable(!1),this.setUpdateDownloading(!1),this.setUpdateDownloaded(!1)}),await r("UPDATE_DOWNLOADING",()=>{this.logger.debug("Update downloading"),this.setCheckingForUpdates(!1),this.setUpdateAvailable(!1),this.setUpdateDownloading(!0),this.setUpdateDownloaded(!1)}),await r("UPDATE_DOWNLOADED",()=>{this.logger.debug("Update downloaded"),this.setCheckingForUpdates(!1),this.setUpdateAvailable(!1),this.setUpdateDownloading(!1),this.setUpdateDownloaded(!0)}),await r("UPDATE_ERROR",p=>{this.logger.debug("Update error",p),this.setCheckingForUpdates(!1),this.setUpdateAvailable(!1),this.setUpdateDownloading(!1),this.setUpdateDownloaded(!1)})})(),window.updater={setUpdateAvailable:this.setUpdateAvailable.bind(this),setUpdateDownloading:this.setUpdateDownloading.bind(this),setUpdateDownloaded:this.setUpdateDownloaded.bind(this),setCheckingForUpdates:this.setCheckingForUpdates.bind(this),checkForUpdates:this.checkForUpdates.bind(this),downloadUpdate:this.downloadUpdate.bind(this),quitAndInstall:this.quitAndInstall.bind(this),clearUpdateCache:this.clearCache.bind(this)}}setCheckingForUpdates(e){this.checkingForUpdates=e}setUpdateAvailable(e){this.updateAvailable=e}setUpdateDownloading(e){this.updateDownloading=e}setUpdateDownloaded(e){this.updateDownloaded=e}async checkForUpdates(){if(this.checkingForUpdates){this.logger.warn("Already checking for updates, skipping check");return}this.logger.debug("Invoking update check"),await h("check_for_updates",{ignorePrereleases:!1})}async downloadUpdate(){if(this.updateDownloading){this.logger.warn("Already downloading an update");return}if(this.updateDownloaded){this.logger.warn("An update is already pending installation");return}this.logger.debug("Invoking update download"),await h("download_update")}async quitAndInstall(){if(!this.updateDownloaded){this.logger.warn("No update is pending installation");return}this.logger.debug("Invoking update install"),await h("install_update")}setEnabled(e){this.enabled=e,e?this.enable():this.disable()}async enable(){if(this.logger.debug("Enabling updater"),this.initialized){this.logger.debug("Updater already initialized, skipping init");return}await this.checkForUpdates(),this.timer=setInterval(async()=>{this.logger.debug("[UpdateTimer] Checking for updates"),await this.checkForUpdates()},36e5),this.initialized=!0}disable(){this.logger.debug("Disabling updater"),this.timer&&clearInterval(this.timer)}async clearCache(){this.logger.debug("Clearing update cache"),await h("clear_update_cache")}}t([l],a.prototype,"initialized",2);t([l],a.prototype,"enabled",2);t([l],a.prototype,"checkingForUpdates",2);t([l],a.prototype,"updateDownloading",2);t([l],a.prototype,"updateDownloaded",2);t([l],a.prototype,"updateAvailable",2);t([l],a.prototype,"timer",2);t([n],a.prototype,"setCheckingForUpdates",1);t([n],a.prototype,"setUpdateAvailable",1);t([n],a.prototype,"setUpdateDownloading",1);t([n],a.prototype,"setUpdateDownloaded",1);t([n],a.prototype,"setEnabled",1);t([n],a.prototype,"enable",1);t([n],a.prototype,"disable",1);export{a as U};
//# sourceMappingURL=CbtG6qj9rjIIDoHC8wMW.js.map
