var f=Object.defineProperty;var w=(u,t,n)=>t in u?f(u,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[t]=n;var p=(u,t,n)=>w(u,typeof t!="symbol"?t+"":t,n);import{G as g}from"./BbvRrMjL3MsrffvEdAHV.js";import{L as y}from"./85yZmE5PqfcNKC64qTgv.js";const l={};class d{constructor(t){p(this,"logger",new y("REST"));p(this,"app");p(this,"headers");this.app=t,this.headers=l}setToken(t){t?this.headers.Authorization=t:delete this.headers.Authorization}static async getEndpointsFromDomain(t){try{return await this.getInstanceDomains(t,t)}catch{}const n=await fetch(`${t.origin}/.well-known/spacebar`,{method:"GET",headers:l,mode:"cors"}).then(s=>s.json()).then(s=>new URL(s.api));return await this.getInstanceDomains(n,t)}static async getInstanceDomains(t,n){const s=await fetch(`${t.toString()}${t.pathname.includes("api")?"":"api"}/policies/instance/domains`,{method:"GET",headers:l,mode:"cors"}).then(c=>c.json());return{api:s.apiEndpoint,gateway:s.gateway,cdn:s.cdn,wellknown:n.toString()}}static makeAPIUrl(t,n={}){const s=new URL(`${g.routeSettings.api}${t}`);return Object.entries(n).forEach(([c,o])=>{s.searchParams.append(c,o)}),s.toString()}static makeCDNUrl(t,n={}){const s=new URL(`${g.routeSettings.cdn}${t}`);return Object.entries(n).forEach(([c,o])=>{s.searchParams.append(c,o)}),s.toString()}async get(t,n={}){return new Promise((s,c)=>{const o=d.makeAPIUrl(t,n);return fetch(o,{method:"GET",headers:this.headers,mode:"cors"}).then(async a=>{var h;if(a.headers.get("content-length")!=="0")return(h=a.headers.get("content-type"))!=null&&h.includes("application/json")?a.ok?a.json():c(await a.json()):a.ok?a.text():c(a.json())}).then(s).catch(c)})}async post(t,n,s={},c={}){return new Promise((o,a)=>{const h=d.makeAPIUrl(t,s);return this.logger.debug(`POST ${h}; payload:`,n),fetch(h,{method:"POST",headers:{...c,...this.headers,"Content-Type":"application/json"},body:n?JSON.stringify(n):void 0,mode:"cors"}).then(async e=>{var r;if((r=e.headers.get("content-type"))!=null&&r.includes("application/json")){const i=await e.json();return e.ok?o(i):a(i)}if(e.headers.get("content-length")!=="0"){const i=await e.text();return e.ok?o(i):a(i)}return e.ok?o(e.status):a(e.statusText)}).catch(a)})}async put(t,n,s={},c={}){return new Promise((o,a)=>{const h=d.makeAPIUrl(t,s);return this.logger.debug(`PUT ${h}; payload:`,n),fetch(h,{method:"PUT",headers:{...c,...this.headers,"Content-Type":"application/json"},body:n?JSON.stringify(n):void 0,mode:"cors"}).then(async e=>{var r;if((r=e.headers.get("content-type"))!=null&&r.includes("application/json")){const i=await e.json();return e.ok?o(i):a(i)}if(e.headers.get("content-length")!=="0"){const i=await e.text();return e.ok?o(i):a(i)}return e.ok?o(e.status):a(e.statusText)}).catch(a)})}async patch(t,n,s={},c={}){return new Promise((o,a)=>{const h=d.makeAPIUrl(t,s);return this.logger.debug(`PATCH ${h}; payload:`,n),fetch(h,{method:"PATCH",headers:{...c,...this.headers,"Content-Type":"application/json"},body:n?JSON.stringify(n):void 0,mode:"cors"}).then(async e=>{var r;if((r=e.headers.get("content-type"))!=null&&r.includes("application/json")){const i=await e.json();return e.ok?o(i):a(i)}if(e.headers.get("content-length")!=="0"){const i=await e.text();return e.ok?o(i):a(i)}return e.ok?o(e.status):a(e.statusText)}).catch(a)})}async postFormData(t,n,s={},c={},o){return new Promise((a,h)=>{const e=d.makeAPIUrl(t,s);this.logger.debug(`POST ${e}; payload:`,n);const r=new XMLHttpRequest;o&&(o.setAbortCallback(()=>{this.logger.debug("[PostFormData]: Message called abort"),r.abort(),h("aborted")}),r.upload.addEventListener("progress",i=>o.updateProgress(i))),r.addEventListener("loadend",()=>r.status>=200&&r.status<300?r.responseType==="json"?a(r.response):a(JSON.parse(r.response)):r.getResponseHeader("content-length")!=="0"?h(r.responseText):h(r.statusText)),r.open("POST",e),Object.entries({...c,...this.headers}).forEach(([i,m])=>{r.setRequestHeader(i,m)}),r.send(n)})}async delete(t,n={},s={}){return new Promise((c,o)=>{const a=d.makeAPIUrl(t,n);return this.logger.debug(`DELETE ${a}`),fetch(a,{method:"DELETE",headers:{...s,...this.headers},mode:"cors"}).then(()=>c()).catch(o)})}}export{d as R};
//# sourceMappingURL=BcCiPGGS8PR90wZpvSQK.js.map
