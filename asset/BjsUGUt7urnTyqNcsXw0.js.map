{"version":3,"file":"BjsUGUt7urnTyqNcsXw0.js","sources":["../../src/controllers/modals/ModalController.tsx"],"sourcesContent":["// adapted from https://github.com/revoltchat/revite/blob/master/src/controllers/modals/ModalController.tsx\n\nimport { action, computed, makeObservable, observable } from \"mobx\";\nimport {\n\tAddServerModal,\n\tBanMemberModal,\n\tCreateChannelModel,\n\tCreateInviteModal,\n\tCreateServerModal,\n\tDeleteMessageModal,\n\tErrorModal,\n\tImageViewerModal,\n\tJoinServerModal,\n\tKickMemberModal,\n\tLeaveServerModal,\n\tSettingsModal,\n} from \"../../components/modals\";\nimport { Modal } from \"./types\";\n\nfunction randomUUID() {\n\treturn \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (c) => {\n\t\t// eslint-disable-next-line no-bitwise\n\t\tconst r = (Math.random() * 16) | 0;\n\t\t// eslint-disable-next-line no-bitwise, no-mixed-operators\n\t\tconst v = c === \"x\" ? r : (r & 0x3) | 0x8;\n\t\treturn v.toString(16);\n\t});\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype Components = Record<string, React.FC<any>>;\n\n/**\n * Handles layering and displaying modals to the user.\n */\nclass ModalController<T extends Modal> {\n\tstack: T[] = [];\n\tcomponents: Components;\n\n\tconstructor(components: Components) {\n\t\tthis.components = components;\n\n\t\tmakeObservable(this, {\n\t\t\tstack: observable,\n\t\t\tpush: action,\n\t\t\tpop: action,\n\t\t\tremove: action,\n\t\t\trendered: computed,\n\t\t\tisVisible: computed,\n\t\t});\n\n\t\tthis.close = this.close.bind(this);\n\t\tthis.closeAll = this.closeAll.bind(this);\n\t}\n\n\t/**\n\t * Display a new modal on the stack\n\t * @param modal Modal data\n\t */\n\tpush(modal: T) {\n\t\tthis.stack = [\n\t\t\t...this.stack,\n\t\t\t{\n\t\t\t\t...modal,\n\t\t\t\tkey: randomUUID(), // TODO:\n\t\t\t},\n\t\t];\n\t}\n\n\t/**\n\t * Remove the top modal from the screen\n\t * @param signal What action to trigger\n\t */\n\tpop(signal: \"close\" | \"confirm\" | \"force\") {\n\t\tthis.stack = this.stack.map((entry, index) => (index === this.stack.length - 1 ? { ...entry, signal } : entry));\n\t}\n\n\t/**\n\t * Close the top modal\n\t */\n\tclose() {\n\t\tthis.pop(\"close\");\n\t}\n\n\t/**\n\t * Close all modals on the stack\n\t */\n\tcloseAll() {\n\t\tthis.stack = [];\n\t}\n\n\t/**\n\t * Remove the keyed modal from the stack\n\t */\n\tremove(key: string) {\n\t\tthis.stack = this.stack.filter((x) => x.key !== key);\n\t}\n\n\t/**\n\t * Render modals\n\t */\n\tget rendered() {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{this.stack.map((modal) => {\n\t\t\t\t\tconst Component = this.components[modal.type];\n\t\t\t\t\tif (!Component) return null;\n\t\t\t\t\treturn <Component {...modal} onClose={() => this.remove(modal.key!)} />;\n\t\t\t\t})}\n\t\t\t</>\n\t\t);\n\t}\n\n\t/**\n\t * Whether a modal is currently visible\n\t */\n\tget isVisible() {\n\t\treturn this.stack.length > 0;\n\t}\n}\n\n/**\n * Modal controller with additional helpers.\n */\nclass ModalControllerExtended extends ModalController<Modal> {\n\t/**\n\t * Write text to the clipboard\n\t * @param text Text to write\n\t */\n\twriteText(text: string) {\n\t\tif (navigator.clipboard) {\n\t\t\tnavigator.clipboard.writeText(text);\n\t\t} else {\n\t\t\tthis.push({\n\t\t\t\ttype: \"clipboard\",\n\t\t\t\ttext,\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport const modalController = new ModalControllerExtended({\n\tadd_server: AddServerModal,\n\t// add_friend: AddFriend,\n\tban_member: BanMemberModal,\n\t// changelog: Changelog,\n\t// channel_info: ChannelInfo,\n\t// clipboard: Clipboard,\n\t// leave_group: ConfirmLeave,\n\t// close_dm: Confirmation,\n\tleave_server: LeaveServerModal,\n\t// delete_server: Confirmation,\n\t// delete_channel: Confirmation,\n\t// delete_bot: Confirmation,\n\t// block_user: Confirmation,\n\t// unfriend_user: Confirmation,\n\t// create_category: CreateCategory,\n\tcreate_channel: CreateChannelModel,\n\t// create_group: CreateGroup,\n\tcreate_invite: CreateInviteModal,\n\t// create_role: CreateRole,\n\tcreate_server: CreateServerModal,\n\tjoin_server: JoinServerModal,\n\t// create_bot: CreateBot,\n\t// custom_status: CustomStatus,\n\tdelete_message: DeleteMessageModal,\n\terror: ErrorModal,\n\timage_viewer: ImageViewerModal,\n\tkick_member: KickMemberModal,\n\t// link_warning: LinkWarning,\n\t// mfa_flow: MFAFlow,\n\t// mfa_recovery: MFARecovery,\n\t// mfa_enable_totp: MFAEnableTOTP,\n\t// modify_account: ModifyAccount,\n\t// onboarding: OnboardingModal,\n\t// out_of_date: OutOfDate,\n\t// pending_friend_requests: PendingFriendRequests,\n\t// server_identity: ServerIdentity,\n\t// server_info: ServerInfo,\n\t// show_token: ShowToken,\n\t// signed_out: SignedOut,\n\t// sign_out_sessions: SignOutSessions,\n\t// user_picker: UserPicker,\n\t// user_profile: UserProfile,\n\t// report: ReportContent,\n\t// report_success: ReportSuccess,\n\t// modify_displayname: ModifyDisplayname,\n\t// changelog_usernames: ChangelogUsernames,\n\tsettings: SettingsModal,\n});\n"],"names":["randomUUID","c","r","ModalController","components","__publicField","makeObservable","observable","action","computed","modal","signal","entry","index","key","x","jsx","Fragment","Component","ModalControllerExtended","text","modalController","AddServerModal","BanMemberModal","LeaveServerModal","CreateChannelModel","CreateInviteModal","CreateServerModal","JoinServerModal","DeleteMessageModal","ErrorModal","ImageViewerModal","KickMemberModal","SettingsModal"],"mappings":"0xBAmBA,SAASA,GAAa,CACrB,MAAO,uCAAuC,QAAQ,QAAUC,GAAM,CAErE,MAAMC,EAAK,KAAK,OAAO,EAAI,GAAM,EAG1B,OADGD,IAAM,IAAMC,EAAKA,EAAI,EAAO,GAC7B,SAAS,EAAE,CAAA,CACpB,CACF,CAQA,MAAMC,CAAiC,CAItC,YAAYC,EAAwB,CAHpCC,EAAA,aAAa,CAAC,GACdA,EAAA,mBAGC,KAAK,WAAaD,EAElBE,EAAe,KAAM,CACpB,MAAOC,EACP,KAAMC,EACN,IAAKA,EACL,OAAQA,EACR,SAAUC,EACV,UAAWA,CAAA,CACX,EAED,KAAK,MAAQ,KAAK,MAAM,KAAK,IAAI,EACjC,KAAK,SAAW,KAAK,SAAS,KAAK,IAAI,CAAA,CAOxC,KAAKC,EAAU,CACd,KAAK,MAAQ,CACZ,GAAG,KAAK,MACR,CACC,GAAGA,EACH,IAAKV,EAAW,CAAA,CAElB,CAAA,CAOD,IAAIW,EAAuC,CAC1C,KAAK,MAAQ,KAAK,MAAM,IAAI,CAACC,EAAOC,IAAWA,IAAU,KAAK,MAAM,OAAS,EAAI,CAAE,GAAGD,EAAO,OAAAD,GAAWC,CAAM,CAAA,CAM/G,OAAQ,CACP,KAAK,IAAI,OAAO,CAAA,CAMjB,UAAW,CACV,KAAK,MAAQ,CAAC,CAAA,CAMf,OAAOE,EAAa,CACd,KAAA,MAAQ,KAAK,MAAM,OAAQC,GAAMA,EAAE,MAAQD,CAAG,CAAA,CAMpD,IAAI,UAAW,CACd,OAEGE,EAAA,IAAAC,EAAA,SAAA,CAAA,SAAA,KAAK,MAAM,IAAKP,GAAU,CAC1B,MAAMQ,EAAY,KAAK,WAAWR,EAAM,IAAI,EACxC,OAACQ,EACEF,MAACE,EAAW,CAAA,GAAGR,EAAO,QAAS,IAAM,KAAK,OAAOA,EAAM,GAAI,CAAG,CAAA,EAD9C,IAEvB,CAAA,EACF,CAAA,CAOF,IAAI,WAAY,CACR,OAAA,KAAK,MAAM,OAAS,CAAA,CAE7B,CAKA,MAAMS,UAAgChB,CAAuB,CAK5D,UAAUiB,EAAc,CACnB,UAAU,UACH,UAAA,UAAU,UAAUA,CAAI,EAElC,KAAK,KAAK,CACT,KAAM,YACN,KAAAA,CAAA,CACA,CACF,CAEF,CAEa,MAAAC,EAAkB,IAAIF,EAAwB,CAC1D,WAAYG,EAEZ,WAAYC,EAMZ,aAAcC,EAOd,eAAgBC,EAEhB,cAAeC,EAEf,cAAeC,EACf,YAAaC,EAGb,eAAgBC,EAChB,MAAOC,EACP,aAAcC,EACd,YAAaC,EAoBb,SAAUC,CACX,CAAC"}