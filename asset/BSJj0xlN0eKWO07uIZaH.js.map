{"version":3,"file":"BSJj0xlN0eKWO07uIZaH.js","sources":["../../src/pages/subpages/MFA.tsx"],"sourcesContent":["import { Routes } from \"@spacebarchat/spacebar-api-types/v9\";\nimport React from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { useNavigate } from \"react-router-dom\";\nimport SpacebarLogoBlue from \"../../assets/images/logo/Logo-Blue.svg?react\";\nimport {\n\tAuthContainer,\n\tFormContainer,\n\tHeader,\n\tHeaderContainer,\n\tInput,\n\tInputContainer,\n\tInputErrorText,\n\tInputLabel,\n\tInputWrapper,\n\tLabelWrapper,\n\tLink,\n\tSubHeader,\n\tSubmitButton,\n\tWrapper,\n} from \"../../components/AuthComponents\";\nimport { TextDivider } from \"../../components/Divider\";\nimport { useAppStore } from \"../../hooks/useAppStore\";\nimport useLogger from \"../../hooks/useLogger\";\nimport {\n\tIAPIError,\n\tIAPILoginResponseMFARequired,\n\tIAPILoginResponseSuccess,\n\tIAPITOTPRequest,\n} from \"../../utils/interfaces/api\";\nimport { messageFromFieldError } from \"../../utils/messageFromFieldError\";\n\ntype FormValues = {\n\tcode: string;\n};\n\ninterface Props extends IAPILoginResponseMFARequired {\n\tclose: () => void;\n}\n\nfunction MFA(props: Props) {\n\tconst app = useAppStore();\n\tconst logger = useLogger(\"MFA\");\n\tconst navigate = useNavigate();\n\tconst [loading, setLoading] = React.useState(false);\n\n\tconst {\n\t\tregister,\n\t\thandleSubmit,\n\t\tformState: { errors },\n\t\tsetError,\n\t} = useForm<FormValues>();\n\n\tconst onSubmit = handleSubmit((data) => {\n\t\tsetLoading(true);\n\n\t\tapp.rest\n\t\t\t.post<IAPITOTPRequest, IAPILoginResponseSuccess>(Routes.mfaTotp(), {\n\t\t\t\t...data,\n\t\t\t\tticket: props.ticket,\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tapp.setToken(r.token, true);\n\t\t\t\tnavigate(\"/app\", { replace: true });\n\t\t\t})\n\t\t\t.catch((r: IAPIError) => {\n\t\t\t\tif (\"message\" in r) {\n\t\t\t\t\t// error\n\t\t\t\t\tif (r.errors) {\n\t\t\t\t\t\tconst t = messageFromFieldError(r.errors);\n\t\t\t\t\t\tif (t) {\n\t\t\t\t\t\t\tsetError(t.field as keyof FormValues, {\n\t\t\t\t\t\t\t\ttype: \"manual\",\n\t\t\t\t\t\t\t\tmessage: t.error,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetError(\"code\", {\n\t\t\t\t\t\t\t\ttype: \"manual\",\n\t\t\t\t\t\t\t\tmessage: r.message,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetError(\"code\", {\n\t\t\t\t\t\t\ttype: \"manual\",\n\t\t\t\t\t\t\tmessage: r.message,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// unknown error\n\t\t\t\t\tlogger.error(r);\n\t\t\t\t\tsetError(\"code\", {\n\t\t\t\t\t\ttype: \"manual\",\n\t\t\t\t\t\tmessage: \"Unknown Error\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.finally(() => setLoading(false));\n\t});\n\n\treturn (\n\t\t<Wrapper>\n\t\t\t<AuthContainer>\n\t\t\t\t<HeaderContainer>\n\t\t\t\t\t<SpacebarLogoBlue height={48} width=\"auto\" />\n\t\t\t\t\t<Header>Two-factor authentication</Header>\n\t\t\t\t\t<SubHeader>You can use a backup code or your two-factor authentication mobile app.</SubHeader>\n\n\t\t\t\t\t<FormContainer onSubmit={onSubmit}>\n\t\t\t\t\t\t<InputContainer marginBottom={true} style={{ marginTop: 0 }}>\n\t\t\t\t\t\t\t<LabelWrapper error={!!errors.code}>\n\t\t\t\t\t\t\t\t<InputLabel>Enter 2FA/Backup Code</InputLabel>\n\t\t\t\t\t\t\t\t{errors.code && (\n\t\t\t\t\t\t\t\t\t<InputErrorText>\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<TextDivider>-</TextDivider>\n\t\t\t\t\t\t\t\t\t\t\t{errors.code.message}\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t</InputErrorText>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</LabelWrapper>\n\t\t\t\t\t\t\t<InputWrapper>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tautoFocus\n\t\t\t\t\t\t\t\t\t{...register(\"code\", { required: true })}\n\t\t\t\t\t\t\t\t\terror={!!errors.code}\n\t\t\t\t\t\t\t\t\tdisabled={loading}\n\t\t\t\t\t\t\t\t\tplaceholder=\"6-digit authentication code/8-digit backup code\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</InputWrapper>\n\t\t\t\t\t\t</InputContainer>\n\n\t\t\t\t\t\t<SubmitButton palette=\"primary\" type=\"submit\" disabled={loading}>\n\t\t\t\t\t\t\tLog In\n\t\t\t\t\t\t</SubmitButton>\n\n\t\t\t\t\t\t{/* <Link\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\twindow.open(\n\t\t\t\t\t\t\t\t\"https://youtu.be/dQw4w9WgXcQ\",\n\t\t\t\t\t\t\t\t\"_blank\",\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t>\n\t\t\t\t\t\tRecieve auth code from SMS\n\t\t\t\t\t</Link> */}\n\n\t\t\t\t\t\t<Link onClick={() => props.close()} type=\"button\">\n\t\t\t\t\t\t\tGo Back to Login\n\t\t\t\t\t\t</Link>\n\t\t\t\t\t</FormContainer>\n\t\t\t\t</HeaderContainer>\n\t\t\t</AuthContainer>\n\t\t</Wrapper>\n\t);\n}\n\nexport default MFA;\n"],"names":["MFA","props","app","useAppStore","logger","useLogger","navigate","useNavigate","loading","setLoading","React","register","handleSubmit","errors","setError","useForm","onSubmit","data","Routes","t","messageFromFieldError","jsx","Wrapper","AuthContainer","HeaderContainer","SpacebarLogoBlue","Header","SubHeader","jsxs","FormContainer","InputContainer","LabelWrapper","InputLabel","InputErrorText","Fragment","TextDivider","InputWrapper","Input","SubmitButton","Link"],"mappings":"2bAwCA,SAASA,EAAIC,EAAc,CAC1B,MAAMC,EAAMC,EAAY,EAClBC,EAASC,EAAU,KAAK,EACxBC,EAAWC,EAAY,EACvB,CAACC,EAASC,CAAU,EAAIC,EAAM,SAAS,EAAK,EAE5C,CACL,SAAAC,EACA,aAAAC,EACA,UAAW,CAAE,OAAAC,CAAO,EACpB,SAAAC,GACGC,EAAoB,EAElBC,EAAWJ,EAAcK,GAAS,CACvCR,EAAW,EAAI,EAEfP,EAAI,KACF,KAAgDgB,EAAO,QAAA,EAAW,CAClE,GAAGD,EACH,OAAQhB,EAAM,MAAA,CACd,EACA,KAAM,GAAM,CACRC,EAAA,SAAS,EAAE,MAAO,EAAI,EAC1BI,EAAS,OAAQ,CAAE,QAAS,EAAA,CAAM,CAAA,CAClC,EACA,MAAO,GAAiB,CACxB,GAAI,YAAa,EAEhB,GAAI,EAAE,OAAQ,CACP,MAAAa,EAAIC,EAAsB,EAAE,MAAM,EACpCD,EACHL,EAASK,EAAE,MAA2B,CACrC,KAAM,SACN,QAASA,EAAE,KAAA,CACX,EAEDL,EAAS,OAAQ,CAChB,KAAM,SACN,QAAS,EAAE,OAAA,CACX,CACF,MAEAA,EAAS,OAAQ,CAChB,KAAM,SACN,QAAS,EAAE,OAAA,CACX,OAIFV,EAAO,MAAM,CAAC,EACdU,EAAS,OAAQ,CAChB,KAAM,SACN,QAAS,eAAA,CACT,CAEF,CAAA,EACA,QAAQ,IAAML,EAAW,EAAK,CAAC,CAAA,CACjC,EAED,OACEY,MAAAC,EAAA,CACA,SAACD,EAAA,IAAAE,EAAA,CACA,gBAACC,EACA,CAAA,SAAA,CAAAH,EAAA,IAACI,EAAiB,CAAA,OAAQ,GAAI,MAAM,OAAO,EAC3CJ,EAAAA,IAACK,GAAO,SAAyB,2BAAA,CAAA,EACjCL,EAAAA,IAACM,GAAU,SAAuE,yEAAA,CAAA,EAElFC,EAAAA,KAACC,GAAc,SAAAb,EACd,SAAA,CAAAY,OAACE,GAAe,aAAc,GAAM,MAAO,CAAE,UAAW,CACvD,EAAA,SAAA,CAAAF,EAAA,KAACG,EAAa,CAAA,MAAO,CAAC,CAAClB,EAAO,KAC7B,SAAA,CAAAQ,EAAAA,IAACW,GAAW,SAAqB,uBAAA,CAAA,EAChCnB,EAAO,MACNQ,EAAAA,IAAAY,EAAA,CACA,SACCL,EAAA,KAAAM,WAAA,CAAA,SAAA,CAAAb,EAAAA,IAACc,GAAY,SAAC,GAAA,CAAA,EACbtB,EAAO,KAAK,OAAA,CAAA,CACd,CACD,CAAA,CAAA,EAEF,QACCuB,EACA,CAAA,SAAAf,EAAA,IAACgB,EAAA,CACA,KAAK,OACL,UAAS,GACR,GAAG1B,EAAS,OAAQ,CAAE,SAAU,GAAM,EACvC,MAAO,CAAC,CAACE,EAAO,KAChB,SAAUL,EACV,YAAY,iDAAA,CAAA,CAEd,CAAA,CAAA,EACD,EAEAa,EAAAA,IAACiB,GAAa,QAAQ,UAAU,KAAK,SAAS,SAAU9B,EAAS,SAEjE,QAAA,CAAA,EAcAa,EAAAA,IAACkB,GAAK,QAAS,IAAMtC,EAAM,MAAM,EAAG,KAAK,SAAS,SAElD,kBAAA,CAAA,CAAA,CACD,CAAA,CAAA,CACD,CAAA,CACD,CAAA,EACD,CAEF"}