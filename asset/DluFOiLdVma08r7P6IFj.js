var E=Object.defineProperty;var D=(m,t,s)=>t in m?E(m,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[t]=s;var p=(m,t,s)=>D(m,typeof t!="symbol"?t+"":t,s);import{aK as c,ai as g,aj as P}from"./DIBLJojdTQB51I2zM4gm.js";import{L as O}from"./85yZmE5PqfcNKC64qTgv.js";var U=Object.defineProperty,v=Object.getOwnPropertyDescriptor,l=(m,t,s,i)=>{for(var r=i>1?void 0:i?v(t,s):t,u=m.length-1,n;u>=0;u--)(n=m[u])&&(r=(i?n(t,s,r):n(r))||r);return i&&r&&U(t,s,r),r};class d{constructor(t,s,i){p(this,"logger",new O("GuildMemberListStore"));p(this,"app");p(this,"id");p(this,"guild");p(this,"groups",[]);p(this,"member_count");p(this,"online_count");p(this,"list",[]);this.app=t,this.guild=s;const{groups:r,id:u,member_count:n,online_count:b,ops:o}=i;this.id=u,this.groups=r,this.member_count=n,this.online_count=b,this.computeListData(i.ops)}update(t){const{groups:s,id:i,member_count:r,online_count:u,ops:n}=t;this.id=i,this.groups=s,this.member_count=r,this.online_count=u,this.computeListData(t.ops)}computeListData(t){for(const s of t){const{op:i,items:r,range:u,item:n,index:b}=s;switch(i){case c.SYNC:{let o=[];for(const e of r)if("group"in e){const a=this.app.roles.get(e.group.id);o.push({title:`${((a==null?void 0:a.name)??e.group.id).toUpperCase()}`,data:[]})}else{this.app.presences.add({...e.member.presence,guild_id:this.guild.id});const a=this.guild.members.get(e.member.id);if(a)o[o.length-1].data.push({member:a,index:e.member.index});else{const h=this.guild.members.add(e.member);o[o.length-1].data.push({member:h,index:e.member.index})}}o=o.filter(e=>e.data.length>0),o=o.map(e=>({...e,title:`${e.title} - ${e.data.length}`})),o=o.filter(e=>!(e.title.toLowerCase().startsWith("offline")&&e.data.length>=100)),this.list=o.map(e=>({name:e.title,items:e.data.sort((a,h)=>{var L,w;const f=(L=a.member.user)==null?void 0:L.username,_=(w=h.member.user)==null?void 0:w.username;return f&&_?f.toLowerCase()>_.toLowerCase()?1:-1:0}).map(a=>a.member)}));break}case c.DELETE:{this.logger.warn("Unimplemented OP DELETE",n),this.logger.debug("DELETE",n);break}case c.UPDATE:{this.logger.warn("Unimplemented OP UPDATE",n);break}case c.INSERT:{this.logger.warn("Unimplemented OP INSERT",n);break}default:{this.logger.warn(`Uknown OP: ${i}`);break}}}}}l([g],d.prototype,"groups",2);l([g],d.prototype,"member_count",2);l([g],d.prototype,"online_count",2);l([g],d.prototype,"list",2);l([P],d.prototype,"update",1);export{d as G};
//# sourceMappingURL=DluFOiLdVma08r7P6IFj.js.map
